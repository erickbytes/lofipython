<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lo-Fi Python</title>
    <link rel="shortcut icon" type="image/png" href="https://lofipython.com/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://lofipython.com/favicon.ico">
    <link href="https://lofipython.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Lo-Fi Python Full Atom Feed" />
    <link href="https://lofipython.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Lo-Fi Python Full RSS Feed" />
    <link rel="stylesheet" href="https://lofipython.com/theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://lofipython.com/theme/css/pygments.css" type="text/css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="@erickbytes" />
</head>
<body>
    <header>
        <nav style="overflow: hidden;">
            <ul>
                <li class="selected"><a href="https://lofipython.com/">Home</a></li>
                <li><a href="feeds/all.rss.xml">RSS</a></li>
                <li><a href="feeds/all.atom.xml">Atom</a></li>
                <li><a href="https://github.com/erickbytes/lofipython">Github</a></li>
                <li><a href="https://lofipython.com/contact">Need a Python Dev?</a></li>
            </ul>
        </nav>
        <div class="header_box" style="height: 50px">
        <h1><a href="https://lofipython.com/">
            <image src='images/python-powered-h-140x182.png' class="avatar" width="50px" /><span class="site_title">Lo-Fi Python</span>
            </a></h1></div>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Apr 07, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/troubleshooting-tracebacks-to-resurrect-a-web2py-app.html" rel="bookmark" title="Permanent Link to &quot;Troubleshooting Tracebacks to Resurrect a Python Web2py App&quot;">Troubleshooting Tracebacks to Resurrect a Python Web2py App</a>
                </h2>

                
                

                <p>Back in 2016, I <a class="reference external" href="https://lofipython.com/askkevinparker-com-my-first-web-app-other-notes">built a web2py app</a>
as my first web application. It accepts a prompt from the user and
primitively attempts to match that text to a line of Kevin Parker's lyrics.</p>
<p>I didn't look at the app's code for many years, I just needed to log into PythonAnywhere every 3 months
and hit a button to keep it running on their free plan. Until I decided to update it recently.</p>
<p>Tame Impala released a new album and lots of additional tracks to import to the app.
Just need to update the database with new music. No big deal easy peasy, right? Wrong!</p>
<p>Part of the problem was that I didn't remember where the important code like the controller default.py
and HTML files were after not seeing it for 3+ years. It took me some time to remember the folder
structure of a web2py project also.</p>
<p><strong>web2py Python Errors Solved</strong></p>
<p>I installed web2py locally with the help of a <a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-use-the-web2py-framework-to-quickly-build-your-python-app">DigitalOcean blog post</a>.
After I failed to push a new version of the app to production, for some reasons it was in a broken state.
Python version issues popped up and required some heady navigation. Enjoy these gritty details
of the tracebacks that transpired.</p>
<pre class="code console literal-block">
<span class="go">ModuleNotFoundError: No module named 'formatter'</span>
</pre>
<img alt="formatter module missing in Python WSGI app" src="https://lofipython.com/images/ModuleNotFoundError-no-module-named-formatter.png" />
<p>This error popped up in my app's WSGI error logs. I researched the <a class="reference external" href="https://pypi.org/project/formatter/">formatter module</a>.
I believe this was caused by attempting to run Python my code compiled to a .w2p file
on Python 3.11 on a Python 3.10 interpreter. However, I didn't know how to solve it until after I saw the next error.</p>
<pre class="code console literal-block">
<span class="go">SystemError: compiled code is incompatible</span>
</pre>
<img alt="incompatible python interpreter and compiled python code" src="https://lofipython.com/images/SystemError-compiled-code-is-incompatible-cause.png" />
<p>Once I read this error, I consulted Bing about it. One of the options that Bing suggested was
that my Python code had incompatible versions. This was caused by a mismatch between my development
and production Python versions.</p>
<p><strong>Installing Python 3.10 in Development Environment</strong></p>
<p>I compiled the updated web2py app in Python 3.11 on my Chromebook. My PythonAnywhere environment was
running Python 3.10. Therefore, I need to build the development version in Python 3.10 to match the
production environment on PythonAnywhere. I then entered a handful of commands and waited for Python 3.10
to compile in my Ubuntu development environment.</p>
<p>After compiling the development version and importing it to PythonAnywherem, the app shows a different error!
Since I was using a .w2p file to import the app to my dev environment and back to production,
it contained old Python web2py code written in earlier Python versions with a few more bugs that surfaced.</p>
<pre class="code console literal-block">
<span class="go">SyntaxError: multiple exception types must be parenthesized</span>
</pre>
<img alt="exception types must be parenthesized in Python" src="https://lofipython.com/images/SyntaxError-exception-types-must-be-parenthesized.png" />
<p>This error showed up in my appadmin.py. At some point this unparenthensized syntax was phased out of Python.
The fix is add parentheses to the exception statements:</p>
<p><em>Incorrect</em></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</pre></div></td></tr></table></div>
<p><em>Correct</em></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
</pre></div></td></tr></table></div>
<pre class="code console literal-block">
<span class="go">unable to parse csv file: iterator should return strings, not bytes (the file should be opened in text mode)</span>
</pre>
<p>In order to import the Tame Impala new songs to the SQLlite database, web2py provides access to a
GUI interface in its admin panel. I could either manually enter each song or use its csv import widget.
To save time, I imported via csv. However, this error slowed me down.
It stemmed from the need for TextIOWrapper to convert the csv data to a required format.</p>
<img alt="unable to parse csv Python fix with TextIOWrapper" src="https://lofipython.com/images/unable-to-parse-csv-fix.png" />
<p>The solution I found was to use the
<a class="reference external" href="https://github.com/web2py/web2py/issues/2148#issuecomment-616036400">fix suggested by AnooshaAviligonda</a>.
In web2py/gluon/packages/dal/pydal/objects.py, I swapped in this code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">utf8_data</span><span class="p">,</span><span class="n">encoding</span><span class="p">),</span> <span class="n">dialect</span><span class="o">=</span><span class="n">dialect</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>After adding the above code to my web2py app's object.py file, the csv importer was functional again.
I successfully imported the new songs to my app and brought the code forward into future Python versions.
Keeping up with this project over the years shows how maintaining an app across different Python versions
can cause unexpected bugs. After some tough Python tracebacks conquered, the app is now functional,
updated with all Tame Impala's new music and live on the web again!</p>
<p><strong>Check out my Tame Impala web2py app here:</strong></p>
<p><a class="reference external" href="http://tameimpala.pythonanywhere.com/tameimpala">tameimpala.pythonanywhere.com/tameimpala</a>.</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/troubleshooting-tracebacks-to-resurrect-a-web2py-app.html">posted at 20:53</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-web2py-apps.html" rel="tag">coding, programming, python, web2py, apps</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/troubleshooting-web2py-app.html" class="tags">troubleshooting web2py app</a>
                    &nbsp;<a href="https://lofipython.com/tag/updating-old-python-code.html" class="tags">updating old Python code</a>
                    &nbsp;<a href="https://lofipython.com/tag/maintaining-python-code.html" class="tags">maintaining python code</a>
                </div>
            </article>            <h4 class="date">Mar 31, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/how-to-write-a-custom-django-html-filter.html" rel="bookmark" title="Permanent Link to &quot;Run Python in Your HTML Via a Custom Django Template Tags Filter&quot;">Run Python in Your HTML Via a Custom Django Template Tags Filter</a>
                </h2>

                
                

                <p>This post shows how to set up a custom Django template tag filter. With help from Django's load built-in,
you can execute a Python function from your app's HTML. In this example, the function returns the quotient,
or result of dividing two numbers. Mathematics and Python for the win!</p>
<p>I worked some of this out with help from Bing and
following along with the <a class="reference external" href="https://docs.djangoproject.com/en/5.0/howto/custom-template-tags/">Django custom template tags documentation</a>.</p>
<p><strong>Install Django Python Library</strong></p>
<pre class="code console literal-block">
<span class="go">pip install Django</span>
</pre>
<p><strong>Create templatetags.py</strong></p>
<p>I created a &quot;templatetags&quot; folder in the app folder and placed templatetags.py within it.
The Django docs recommend your app's folder. Below, the &#64;register.filter decorator registers the divide function so Django knows it exists.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register</span><span class="o">.</span><span class="n">filter</span>
<span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">divisor</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;A Django filter that accepts 2 arguments:</span>
<span class="sd">   1. value, number to be divided</span>
<span class="sd">   2. divisor, number to divide by</span>

<span class="sd">   Returns the quotient in hundredths decimal format.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="c1"># Check if the argument is zero to avoid division by zero error.</span>
   <span class="k">if</span> <span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="kc">None</span>
   <span class="n">quotient</span> <span class="o">=</span> <span class="n">value</span> <span class="o">/</span> <span class="n">divisor</span>
   <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">quotient</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div></td></tr></table></div>
<p><strong>Edit Your HTML Code to Call the Divide Function</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span>{% extends &#39;base.html&#39; %}
{% block content %}
{% load templatetags %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: inline-block; inline-size: 90%; block-size: auto; writing-mode: horizontal-tb;&quot;</span><span class="p">&gt;</span>
{% for hotel in hotels %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row row-cols-3&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display: flex; justify-content: flex-end; padding: 10px; margin: 10px; background-color: #f0ffff; box-shadow: 5px 5px 10px gray; border-radius: 10px;&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;color: green;&quot;</span><span class="p">&gt;</span>Peso: ${{ hotel.price }}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">h5</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;color: gray;&quot;</span><span class="p">&gt;</span>USD: ${{ hotel.price|divide:16.5 }}<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endfor %}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div></td></tr></table></div>
<p>In the HTML, call the divide function by loading the templatetags module and then passing two numeric arguments:</p>
<pre class="code console literal-block">
<span class="go">{{ hotel.price|divide:16.5 }}</span>
</pre>
<ol class="arabic simple">
<li>A number to be divided, here the hotel price from a &quot;Hotel&quot; DB model</li>
<li>The function name to call and a number to divide by. Here we use &quot;divide:16.5&quot; to approximately convert Mexican pesos to US dollars. Currently, the exchange rate fluctuates between 16-17 pesos per dollar.</li>
</ol>
<p><strong>Basic Hotel Model Example</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Hotel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
   <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
   <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
   <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
   <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
   <span class="n">all_inclusive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
   <span class="n">photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s2">&quot;media&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p><strong>Register Model in admin.py</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Hotel</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Hotel</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>I was pleased to be able to make some on the fly mathematic calculations in my HTML
with a custom Django filter!</p>
<img alt="django filter in action example HTML page" src="https://lofipython.com/images/django-filter-successful.png" />

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/how-to-write-a-custom-django-html-filter.html">posted at 16:18</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-django.html" rel="tag">coding, programming, python, Django</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/django-custom-filter.html" class="tags">django custom filter</a>
                    &nbsp;<a href="https://lofipython.com/tag/dynamic-html-python-django.html" class="tags">dynamic HTML python django</a>
                    &nbsp;<a href="https://lofipython.com/tag/running-python-in-django-html.html" class="tags">running Python in Django HTML</a>
                </div>
            </article>            <h4 class="date">Mar 01, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/validating-rst-links-with-rst-url-validator.html" rel="bookmark" title="Permanent Link to &quot;Find Broken Links in Your .rst Documents With rst-url-validator&quot;">Find Broken Links in Your .rst Documents With rst-url-validator</a>
                </h2>

                
                

                <p>The posts on this blog are written in <a class="reference external" href="https://www.writethedocs.org/guide/writing/reStructuredText/">reStructuredText</a>.
I recently had an idea to write a Python script to check my .rst document url links for broken tags or urls that are not valid.
When I'm using <a class="reference external" href="https://pypi.org/project/pelican/">Pelican</a>, it hints when a url tag is malformed and gives a line number.
However, it can still be difficult to track down a problematic link when there's an issue in your document.</p>
<p>So I did what any other programmer probably does in 2024, opened up an AI assistant. Bing quickly generated the structure
of the Python script from my prompt, but like usual it required some tinkering and refinement to make it work.
You can find the complete Python script in the <a class="reference external" href="https://github.com/erickbytes/rst-url-validator">rst-url-validator Github repo</a>.</p>
<p>Bing was also valuable for helping me modify the <a class="reference external" href="https://docs.python.org/3/howto/regex.html">regex module</a> code
for rst-url-validator. It is typically very confusing to reason about regex,
but with AI assistance I can just ask it for regex that does something and
the AI can generate the code. Coding is getting way easier than it used to be thanks
to these new advances in large language models.</p>
<p><strong>Install Python Library Dependencies</strong></p>
<p>The script uses <a class="reference external" href="https://pypi.org/project/requests/">requests</a> to send an HTTP request to the url
and <a class="reference external" href="https://pypi.org/project/rich/">rich</a> to print color-coded output to the terminal screen.</p>
<pre class="code console literal-block">
<span class="go">pip install requests
pip install rich</span>
</pre>
<p><strong>Clone The Github Repo</strong></p>
<pre class="code console literal-block">
<span class="go">git clone git&#64;github.com:erickbytes/rst-url-validator.git
cd rst-url-validator</span>
</pre>
<p><strong>Run The CLI Command</strong></p>
<pre class="code console literal-block">
<span class="go">python rst-url-validator.py your_file.rst</span>
</pre>
<img alt="validate .rst document urls with python" src="https://lofipython.com/images/rst-report.png" />
<p>It parses each url tag, checks for required characters and sends a <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD">HEAD</a> request
to the url to check if it loads successfully. Some websites return status codes like 403 (permission denied), 301 (redirect), or 404 (page not found).
If the status code returned is 200, it's safe to say the page loaded. Be aware that some sites like Cloudflare (returns 403) and Amazon (returns 503) do not serve
any requests and just return an error. In cases like these, you'll need to check pages like this manually in a browser to see if the page loads.</p>
<p>This script helped me find and fix or remove a bunch of broken links on the older posts on this blog. If you're working with .rst documents, give it a try!</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/validating-rst-links-with-rst-url-validator.html">posted at 12:56</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-writing-rst-restructuredtext.html" rel="tag">coding, programming, python, writing, .rst, reStructuredtext</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/restructuredtext-format.html" class="tags">reStructuredtext Format</a>
                    &nbsp;<a href="https://lofipython.com/tag/python-rst-url-validation.html" class="tags">python rst url validation</a>
                    &nbsp;<a href="https://lofipython.com/tag/how-to-validate-rst-links.html" class="tags">how to validate .rst links</a>
                </div>
            </article>            <h4 class="date">Feb 22, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/fixing-install_image_loader_timed_out-on-crostini-linux-chromebook-terminal.html" rel="bookmark" title="Permanent Link to &quot;Fixing INSTALL_IMAGE_LOADER_TIMED_OUT Error 52 on Crostini Linux Terminal for Chromebook&quot;">Fixing INSTALL_IMAGE_LOADER_TIMED_OUT Error 52 on Crostini Linux Terminal for Chromebook</a>
                </h2>

                
                

                <p>When booting up the Ubuntu shell on my Chromebook, it usually just works. However, After I updated
to a new version of Chromebook OS, I was getting this error:</p>
<blockquote>
<dl class="docutils">
<dt>vmshell failed:</dt>
<dd><dl class="first last docutils">
<dt>Error starting crostini for terminal:</dt>
<dd>52 (INSTALL_IMAGE_LOADER_TIMED_OUT)</dd>
</dl>
</dd>
</dl>
</blockquote>
<p>First, I restarted my Chromebook but the error persisted after restarting. So I turned to Bing Copilot:</p>
<img alt="asking bing how to fix crostini error code 52" src="https://lofipython.com/images/bing-restart-crostini.png" />
<p>source: <a class="reference external" href="bing.com">Bing</a></p>
<p><strong>Open Crosh: ctrl + alt + T</strong></p>
<p><strong>Stop The Termina Container in Crosh</strong></p>
<pre class="code console literal-block">
<span class="go">vmc stop termina</span>
</pre>
<p><strong>Start The Termina Container in Crosh</strong></p>
<pre class="code console literal-block">
<span class="go">vmc start termina</span>
</pre>
<p>The vmc command is used to manage Linux containers from Crosh. After I entered these two vmc commands,
the error was resolved. My Crostini Linux shell is functional again!</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/fixing-install_image_loader_timed_out-on-crostini-linux-chromebook-terminal.html">posted at 13:22</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/programming-linux-shell.html" rel="tag">programming, linux, shell</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/troubleshooting-chromebook-crostini-error-52.html" class="tags">troubleshooting chromebook crostini error 52</a>
                    &nbsp;<a href="https://lofipython.com/tag/solving-image-loader-timed-out-error.html" class="tags">solving image loader timed out error</a>
                    &nbsp;<a href="https://lofipython.com/tag/restart-chromebook-linux-container.html" class="tags">restart chromebook linux container</a>
                </div>
            </article>            <h4 class="date">Feb 21, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/passing-the-webmention-rocks-webmention-update-test-with-curl.html" rel="bookmark" title="Permanent Link to &quot;Passing the Webmention Rocks! Webmention Update Test With curl and Setting Up a Webmention.io Endpoint&quot;">Passing the Webmention Rocks! Webmention Update Test With curl and Setting Up a Webmention.io Endpoint</a>
                </h2>

                
                

                <p>After discovering Webmentions via a <a class="reference external" href="https://localghost.dev/blog/sending-webmentions-from-a-static-site/">helpful blog post about sending webmentions</a>,
I wondered how I might be able to achieve sending and receiving them from my Pelican blog. I discovered the
<a class="reference external" href="Webmention.Rocks">Webmention Rocks!</a> website and the <a class="reference external" href="https://www.w3.org/TR/webmention/">Webmention Protocol</a>.
Webmentions are a standard for sending notification of linkbacks, likes, comments and pingbacks via HTTP.
For example, if your blog is hosted on Wordpress these things are likely all set up for you.
Supporting this recommended standard requires a more creative approach on a static site.</p>
<p>Naturally, I'm now thinking about how I will automate this on my Pelican blog. There are also existing
Python modules like <a class="reference external" href="https://pypi.org/project/ronkyuu/">ronkyuu</a> and the
<a class="reference external" href="https://indieweb-utils.readthedocs.io/en/latest/">indieweb-utils</a> modules for supporting the
Webmention protocol in Python. However, a static site generator presents challenges for automatically
executing code to send webmentions. Another option may be to use something like Cloudflare Workers
since this blog is hosted on Cloudflare's free plan. Possibly, I could set a worker to trigger and
run some javascript everytime I add a new post. I'm thinking using an existing pelican plugin would
likely be easier than that.</p>
<p>Thankfully, there are some existing <a class="reference external" href="https://github.com/getpelican/pelican-plugins">Pelican plugins</a> to enable webmentions.
I'm currently testing the <a class="reference external" href="https://github.com/drivet/pelican-webmention">pelican-webmention plugin</a>
but have not yet verified if it is actually sending the webmentions. Alternatively, the
<a class="reference external" href="https://github.com/pelican-plugins/linkbacks/">linkbacks plugin</a> is an option for supporting Webmentions
on a Pelican blog. <a class="reference external" href="https://brid.gy/about#blogs">Bridgy</a> is another tool written
in Python as a &quot;bridge&quot; for social networks to webmentions. There are a lot of interesting options
for piecing together a Webmention implementation, which is essentially automating an HTTP request you send
when you link to someone else from your website.</p>
<p>In the interim until an automated solution is found I decided to attempt passing the
Webmention Rocks! Update test with curl. Often I find when HTTP requests are required, I can better
understand it by manually making the requests with curl or Python. Once I have a better grasp
after succeeding with curl, it's a little easier to grasp automating the sending of the HTTP requests
with Python or other means.</p>
<div class="section" id="completing-the-webmention-rocks-update-test-1-with-curl">
<h2>Completing the Webmention Rocks! <a class="reference external" href="https://webmention.rocks/update/1">Update Test #1</a> With curl</h2>
<p><strong>Add a URL Link to Your Blog HTML, AKA The &quot;Webmention&quot;</strong></p>
<pre class="code html literal-block">
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://webmention.rocks/update/1&quot;</span><span class="p">&gt;</span>Part 1 Test<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre>
<p><strong>Check Target HTML for Webmention Endpoint with Curl</strong></p>
<pre class="code console literal-block">
<span class="go">curl -i -s $target | grep 'rel=&quot;webmention&quot;'</span>
</pre>
<p><strong>Alternative Browser Option: &quot;View Page Source&quot; to Find Webmention Endpoint</strong></p>
<img alt="finding the webmentions endpoint in a browser" src="https://lofipython.com/images/webmentions-test-endpoint.png" />
<p>Go to the page you want to check for a Webmention endpoint. Right-click anywhere on the page
and select &quot;View Page Source&quot; to view the website's HTML. Then, right-click the endpoint url
and select &quot;Copy Link Address&quot; to copy the full url of the endpoint.</p>
<p><strong>Send a curl Request Notify the Target Site of Webmention Update</strong></p>
<pre class="code console literal-block">
<span class="go">curl -X POST -H &quot;Content-Type: application/x-www-form-urlencoded&quot; -d &quot;source=https://yourblog.com/example-post&amp;target=https://webmention.rocks/update/1&quot; https://webmention.rocks/update/1/part/1/webmention?key=UjJPJoDWZateFb7bTAhB -v</span>
</pre>
<p>In the curl request, edit the &quot;source&quot; with your blog post containing the link and &quot;target&quot;
with the target Webmention endpoint. You'll need to change the &quot;key&quot; url argument. The Webmention Rocks!
endpoint changes the live key rapidly, about every 30 seconds. In curl, you can pass the -v argument
for more verbose output.</p>
<p><strong>Add URL Link to HTML for Part 2 of the Test</strong></p>
<pre class="code html literal-block">
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://webmention.rocks/update/1/part/2&quot;</span><span class="p">&gt;</span>Part 2 Test<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre>
<p><strong>Complete Part 2 of the Test with curl</strong></p>
<pre class="code console literal-block">
<span class="go">curl -X POST -H &quot;Content-Type: application/x-www-form-urlencoded&quot; -d &quot;source=https://yourblog.com/example-post&amp;target=https://webmention.rocks/update/1&quot; https://webmention.rocks/update/1/part/2/webmention?key=dfMuwOn4DUuwRSe6BM9o -v</span>
</pre>
<p><strong>Webmention Update Test Succeeded Confirmation</strong></p>
<img alt="successful Webmentions Rocks! Webmention Update Test" src="https://lofipython.com/images/successful-webmentions-test.png" />
<p><strong>Check for a Webmention Endpoint and Send the Request in a Bash One-Liner</strong></p>
<pre class="code console literal-block">
<span class="go">curl -i -d &quot;source=$your_url&amp;target=$target_url&quot; `curl -i -s $target_url | grep 'rel=&quot;http://webmention.org/&quot;' | sed 's/rel=&quot;webmention&quot;//' | grep -o -E 'https?://[^ &quot;&gt;]+' | sort | uniq`</span>
</pre>
<p>source: <a class="reference external" href="https://indieweb.org/webmention-implementation-guide">https://indieweb.org/webmention-implementation-guide</a></p>
</div>
<div class="section" id="setting-up-your-blog-s-webmentions-endpoint-with-webmention-io">
<h2>Setting Up Your Blog's Webmentions Endpoint With webmention.io</h2>
<p>Webmention.io is a free service to set up your own Webmention endpoint so other people can send
you Webmentions. I chose to authenticate with Github. There are also options to authenticate
via email and other ways. If you choose to authenticate with Github, make sure the url
of your website is in your Github profile.</p>
<p><strong>Add Github HTML Link to Your Website</strong></p>
<p>First, add the Github HTML link to your website identify yourself to webmention.io.</p>
<pre class="code html literal-block">
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://github.com/your_username&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;me&quot;</span><span class="p">&gt;</span>
</pre>
<p><strong>Go to Webmention.io to Authorize Indie Login to Your Github Account</strong></p>
<img alt="connect indie login with Github" src="https://lofipython.com/images/authorize-indie-login.png" style="width: 400px;" />
<p>Once you successfully connect your Github account to webmention.io, you can copy your HTML code
from the webmention.io dashboard to your website HTML:</p>
<pre class="code html literal-block">
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;webmention&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://webmention.io/yourblog.com/webmention&quot;</span> <span class="p">/&gt;</span>
</pre>
<p>With an active endpoint linked in your website HTML, you're able to receive webmentions from
the Webmention.io dashboard or with curl.</p>
<p><strong>View Webmentions for Your Blog with curl</strong></p>
<pre class="code console literal-block">
<span class="go">curl -X GET https://webmention.io/api/mentions.jf2?target=https://exampleblog.com</span>
</pre>
<p>Happy webmentioning!</p>
<p><strong>Read More About Webmentions</strong></p>
<p><a class="reference external" href="https://indieweb.org/Webmention">Webmention Wiki</a></p>
<p><a class="reference external" href="https://github.com/aaronpk/webmention.io">Webmention.io Github</a></p>
<p><a class="reference external" href="Webmention.Rocks">Webmention.Rocks</a></p>
<p><a class="reference external" href="https://aaronparecki.com/2018/06/30/11/your-first-webmention">Sending Your First Webmention Guide</a></p>
</div>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/passing-the-webmention-rocks-webmention-update-test-with-curl.html">posted at 15:37</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-curl-webmentions-blogging.html" rel="tag">coding, programming, curl, webmentions, blogging</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/webmention-protocol.html" class="tags">webmention protocol</a>
                    &nbsp;<a href="https://lofipython.com/tag/implementing-webmentions-on-a-blog.html" class="tags">implementing webmentions on a blog</a>
                    &nbsp;<a href="https://lofipython.com/tag/receiving-webmentions-with-webmentionio.html" class="tags">receiving webmentions with webmention.io</a>
                    &nbsp;<a href="https://lofipython.com/tag/testing-webmentions.html" class="tags">testing webmentions</a>
                    &nbsp;<a href="https://lofipython.com/tag/sending-webmentions.html" class="tags">sending webmentions</a>
                </div>
            </article>            <h4 class="date">Feb 16, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/make-your-python-installs-faster-with-uv.html" rel="bookmark" title="Permanent Link to &quot;Make Your Python Installs Faster With uv&quot;">Make Your Python Installs Faster With uv</a>
                </h2>

                
                

                <p>For several years, <a class="reference external" href="https://pip.pypa.io/en/stable/">pip</a> and <a class="reference external" href="https://pypi.org/project/pip-tools/">pip-tools</a> have become distinguished in Python packaging
for their usability and ubiquity. Recently there has been some interesting new developments
in the realm of Python packaging tools. In a trend that started around 2022, there has been an
ongoing &quot;Rustification&quot; of Python tooling.</p>
<blockquote>
<p>uv is designed as a drop-in replacement for pip and pip-tools, and is
ready for production use today in projects built around those workflows.</p>
<blockquote>
- Charlie Marsh, &quot;uv: Python Packaging in Rust&quot;, <a class="reference external" href="https://astral.sh/blog/uv">https://astral.sh/blog/uv</a></blockquote>
</blockquote>
<p>First, Rye was released in pursuit of a &quot;cargo for Python&quot;. Cargo is Rust's package manager. It seems to
have inspired Python developers to keep trying to improve on what we have with pip.</p>
<p>While this was happening, in secret the creator of ruff was also working on yet another hybrid
Rust + Python package manager named uv. There's seemingly no end to this man's projects!
ruff quickly supplanted the incumbent Python linters to become a favorite among Python developers.
Could lightning strike twice for the creator of ruff? Seems he won't be a one-hit wonder when it
comes to developing hit Python packages.</p>
<p>Improving Python packaging is an audacious and challenging task. Part of the problem
is that out of the box Python installs can be tough to reason about for new Python developers,
not to mention the hassle of explaining the purpose of virtual environments in Python coding via venv.
One perk of uv is that it includes virtual environments in its workflow.</p>
<blockquote>
<p>uv is 8-10x faster than pip and pip-tools without caching, and 80-115x faster
when running with a warm cache</p>
<blockquote>
- Charlie Marsh, &quot;uv: Python Packaging in Rust&quot;, <a class="reference external" href="https://astral.sh/blog/uv">https://astral.sh/blog/uv</a></blockquote>
</blockquote>
<p>A new space of potential optimization is now accessible to Python developers. We can now use uv
to make our development environment build faster. A modest 8x speedup in Python library installs
might shave off a shocking amount of time it takes your freshly minted Docker image to build,
especially if you have lots of Python library dependencies. Now, imagine an 80-115x speedup with caching.
Docker images also use caching after an image is built the first time. They are an optimization use case
along with building your development environment in general. In some development shops,
this could cut a lot of time installing developer tooling. It's a potential incredible improvement
we can now make with uv!</p>
<a class="reference external image-reference" href="https://twitter.com/charliermarsh/status/1758356727307632892"><img alt="optimizing code with uv tweet" src="https://lofipython.com/images/uv-tweet.png" style="width: 400px;" /></a>
<p>In the case of Rye and uv, two developers simultaneously identified the same opportunity
and are now combining their efforts. Sounds like a win for all Python developers. Armin Ronacher, the
creator of the Flask web framework and Charlie Marsch with the proven success of ruff are converging
to tackle one of Python's biggest pain points. They could be merged into a &quot;cargo for Python&quot; super tool eventually:</p>
<blockquote>
<p><strong>Will Rye be retired for uv?</strong>
Not today, but the desire is that these tools eventually converge into one.</p>
<blockquote>
- Armin Ronacher, &quot;Rye Grows with uv&quot;, <a class="reference external" href="https://lucumr.pocoo.org/2024/2/15/rye-grows-with-uv/">https://lucumr.pocoo.org/2024/2/15/rye-grows-with-uv/</a></blockquote>
</blockquote>
<p>Per Armin's recent blog post, Rye is probably not the final solution. He thinks Rye will get absorbed
into a more fleshed out project like uv. It seems Python packaging will continue evolving and improving,
a welcome sight for Pythonistas!</p>
<img alt="optimize Python installs with uv" src="https://lofipython.com/images/uv-install-benchmarks.png" />
<p><em>Image Source: &quot;uv: Python Packaging in Rust&quot;, https://astral.sh/blog/uv</em></p>
<p><strong>Install uv and rye</strong></p>
<pre class="code console literal-block">
<span class="go">pip install uv
pip install rye

</span><span class="gp"># </span>Alternative<span class="w"> </span>install<span class="w"> </span><span class="k">for</span><span class="w"> </span>uv<span class="w"> </span>with<span class="w"> </span>curl<span class="w">
</span><span class="go">curl -LsSf https://astral.sh/uv/install.sh | sh
</span><span class="gp"># </span>Alternative<span class="w"> </span>Install<span class="w"> </span><span class="k">for</span><span class="w"> </span>rye<span class="w"> </span>on<span class="w"> </span>Linux<span class="w"> </span>and<span class="w"> </span>Mac<span class="w">
</span><span class="go">curl -sSf https://rye-up.com/get | bash</span>
</pre>
<p><strong>Create a Virtual Environment With uv</strong></p>
<pre class="code console literal-block">
<span class="go">uv venv  # Create a virtual environment at .venv.
</span><span class="gp"># </span>Activate<span class="w"> </span>venv<span class="w"> </span>on<span class="w"> </span>macOS<span class="w"> </span>and<span class="w"> </span>Linux.<span class="w">
</span><span class="go">source .venv/bin/activate</span>
</pre>
<p><strong>Installing a New Module With uv</strong></p>
<pre class="code console literal-block">
<span class="go">uv pip install requests</span>
</pre>
<p><strong>pip sync a requirements.txt file with uv</strong></p>
<pre class="code console literal-block">
<span class="go">uv pip sync requirements.txt  # Install from a requirements.txt file.</span>
</pre>
<p><strong>Optional: Configure Rye on Top of uv</strong></p>
<pre class="code console literal-block">
<span class="go">rye config --set-bool behavior.use-uv=true</span>
</pre>
<p><strong>Create a New Python project With Rye</strong></p>
<pre class="code console literal-block">
<span class="go">rye init my-project
rye pin 3.10
rye add black
rye sync
rye run black</span>
</pre>
<p><strong>uv and rye Documentation and Blog Links</strong></p>
<p><a class="reference external" href="https://astral.sh/blog/uv">uv: Python Packaging in Rust</a></p>
<p><a class="reference external" href="https://github.com/astral-sh/uv">uv Github Repo</a></p>
<p><a class="reference external" href="https://lucumr.pocoo.org/2024/2/15/rye-grows-with-uv/">Rye Grows with uv</a></p>
<p><a class="reference external" href="https://rye-up.com/guide/basics/#working-with-the-project">Rye User Guide</a></p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/make-your-python-installs-faster-with-uv.html">posted at 12:33</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python.html" rel="tag">coding, programming, python</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/optimizing-python-installs.html" class="tags">optimizing python installs</a>
                    &nbsp;<a href="https://lofipython.com/tag/uv-python-installation.html" class="tags">uv python installation</a>
                    &nbsp;<a href="https://lofipython.com/tag/installing-python-packages-with-uv.html" class="tags">installing python packages with uv</a>
                </div>
            </article>            <h4 class="date">Feb 09, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/ways-to-free-up-disk-space-on-your-computer.html" rel="bookmark" title="Permanent Link to &quot;Ways to Free Up Disk Space on Your Computer for Python Developers&quot;">Ways to Free Up Disk Space on Your Computer for Python Developers</a>
                </h2>

                
                

                <p>Below are some ways to free up disk space on your computer. This will be most helpful
for Ubuntu users and Python developers. The pip examples show what I used on my Python
version 3.11, so if you're running a different version use that number, like
pip3.12, pip3.10, pip3.9, etc.</p>
<p><strong>Benchmark your current disk space.</strong></p>
<p>Before you start freeing up space, you might want to see the current state of your
hard drive. You can print human readable disk space stats on Ubuntu with the df command.</p>
<pre class="code console literal-block">
<span class="go">df -h</span>
</pre>
<img alt="read disk space stats on Ubuntu" src="https://lofipython.com/images/readdiskspacedfh.png" />
<p>Alternatively, here is a Python script that reads available disk space from your hard drive.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">readable_format</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a bytes integer to a human-readable format.</span>

<span class="sd">    Args:</span>
<span class="sd">        size (int): The bytes integer to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The human-readable format of the bytes integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">size</span> <span class="o">/=</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> PB&quot;</span>


<span class="k">def</span> <span class="nf">disk_space</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the current total, used and free disk space in bytes.&quot;&quot;&quot;</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">total_space</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">total</span>
    <span class="n">used_space</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">used</span>
    <span class="n">free_space</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">free</span>
    <span class="k">return</span> <span class="n">total_space</span><span class="p">,</span> <span class="n">used_space</span><span class="p">,</span> <span class="n">free_space</span>


<span class="c1"># Call the function with the current directory (you can specify a different path)</span>
<span class="n">total_space</span><span class="p">,</span> <span class="n">used_space</span><span class="p">,</span> <span class="n">free_space</span> <span class="o">=</span> <span class="n">disk_space</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total space: </span><span class="si">{</span><span class="n">readable_format</span><span class="p">(</span><span class="n">total_space</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Used space: </span><span class="si">{</span><span class="n">readable_format</span><span class="p">(</span><span class="n">used_space</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Free space: </span><span class="si">{</span><span class="n">readable_format</span><span class="p">(</span><span class="n">free_space</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<pre class="code console literal-block">
<span class="go">Total space: 21.47 GB
Used space: 10.34 GB
Free space: 10.50 GB</span>
</pre>
<p><strong>Clear your browser cache.</strong></p>
<img alt="read disk space stats on Ubuntu" src="https://lofipython.com/images/clearchromecache.png" />
<p><strong>Purge your pip cache.</strong></p>
<p>Before purging the Python pip package manager's cache, you can use the pip cache info command to see how much
storage is consumed by the cache.</p>
<pre class="code console literal-block">
<span class="go">pip3.11 cache info</span>
</pre>
<p>Next, use the <a class="reference external" href="https://pip.pypa.io/en/stable/cli/pip_cache/">pip cache purge command</a>
to clear up space on your system. Pip will print how many files it removed to the terminal.</p>
<pre class="code console literal-block">
<span class="go">pip3.11 cache purge</span>
</pre>
<img alt="clear the pip package manager cache" src="https://lofipython.com/images/pipcachepurge.png" />
<p><strong>Uninstall unnecessary Python libraries.</strong></p>
<p>I tend to build up modules that I installed to see how it works or to quickly test something out,
then never use again. It makes sense to cull your pip installed libraries occasionally.
Be aware that sometimes an unknown module may be a required dependency of a module
you want to use. First, use the pip list command to see your installed libraries:</p>
<pre class="code console literal-block">
<span class="go">pip3.11 list</span>
</pre>
<img alt="view pip installed libraries" src="https://lofipython.com/images/piplist.png" />
<p>The pip uninstall command makes removing Python libraries easy.
For example, let's say you're already using both the ruff Python linter and black.
The ruff module recently introduced a new formatter that is more or less identical
to Black. Therefore, I can uninstall black and the use &quot;ruff format&quot; command instead
to format my code.</p>
<pre class="code console literal-block">
<span class="go">pip3.11 uninstall black</span>
</pre>
<p>If you're not sure about a package, use the pip show command to learn more about it:</p>
<pre class="code console literal-block">
<span class="go">pip3.11 show ruff</span>
</pre>
<img alt="view info about a Python library with pip" src="https://lofipython.com/images/pipshowruff.png" />
<p><strong>Run the autoremove Linux command.</strong></p>
<blockquote>
autoremove is used to remove packages that were automatically installed to satisfy
dependencies for other packages and are now no longer needed as dependencies changed
or the package(s) needing them were removed in the meantime.
- <a class="reference external" href="https://manpages.ubuntu.com/manpages/xenial/man8/apt.8.html">Linux apt Man Pages</a></blockquote>
<pre class="code console literal-block">
<span class="go">sudo apt autoremove</span>
</pre>
<p><strong>Run the clean and autoclean Linux commands.</strong></p>
<pre class="code console literal-block">
<span class="go">sudo apt clean
sudo apt autoclean</span>
</pre>
<p>Read more on Ask Ubuntu: <a class="reference external" href="https://askubuntu.com/questions/3167/what-is-difference-between-the-options-autoclean-autoremove-and-clean">What is the difference between the options &quot;autoclean&quot; &quot;autoremove&quot; and &quot;clean&quot;?</a></p>
<p><strong>Purge unnecessary Linux packages.</strong></p>
<p>First, create a text file with all your installed Linux packages. Then browse the
packages and assess if they can be safely removed.</p>
<pre class="code console literal-block">
<span class="go">apt list --installed &gt; installed_packages.txt</span>
</pre>
<p>You'll free up more space by deleting the largest optional packages. To list your installed
packages in order of their file sizes and priority, you can use dpkg-query:</p>
<pre class="code console literal-block">
<span class="go">dpkg-query -W -f='${Installed-Size;8}\t${Priority}\t${Package}\n' | sort -n -r</span>
</pre>
<img alt="see information about linux packages with dpkg-query" src="https://lofipython.com/images/dpkgreport.png" />
<p>Once you've targeted a package, learn more about it with the apt show command.
It shows if a package is essential or required, a description and its dependency modules.
Optional packages are probably safe to delete assuming it's not a dependency of
software you're actually using. However, purge with caution. Some of these packages are
used in the software underneath your Ubuntu environment. Any leftover packages will
be removed by the autoremove command if they are &quot;orphaned&quot; after you purge a package.</p>
<pre class="code console literal-block">
<span class="go">apt show &lt;package-name&gt;</span>
</pre>
<img alt="see information about a linux package" src="https://lofipython.com/images/aptshowdash.png" />
<p>If you are certain a Linux package can be deleted, the apt-get purge command removes
a package and all configuration files from your computer. Be careful not to remove
any critical Linux packages.</p>
<pre class="code console literal-block">
<span class="go">sudo apt-get purge &lt;package-name&gt;</span>
</pre>
<p><strong>Find and delete your largest Linux files.</strong></p>
<p>This command prints the largest files on your root Linux file system. Then you can
use the rm command to remove the file. Hint: sometimes PDF files can be deceptively
large and can be good targets to free up space.</p>
<pre class="code console literal-block">
<span class="go">sudo find / -xdev -type f -size +25M -exec du -sh {} ';' | sort -rh | head -n 20
rm ~/large_file.pdf</span>
</pre>
<p>That sums up a few ways Ubuntu users and Python developers can add some extra available
disk space. It can definitely be frustrating to watch an install fail because there's
no more space on your computer. These are a few strategies you can deploy to make room
to operate on a disk space constrained system.</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/ways-to-free-up-disk-space-on-your-computer.html">posted at 14:30</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/computer-maintenance-python-ubuntu-disk-space.html" rel="tag">computer maintenance, Python, Ubuntu, disk space</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/how-to-free-up-disk-space.html" class="tags">how to free up disk space</a>
                    &nbsp;<a href="https://lofipython.com/tag/creating-extra-linux-ubuntu-disk-space.html" class="tags">creating extra linux ubuntu disk space</a>
                    &nbsp;<a href="https://lofipython.com/tag/cleaning-up-disk-space-on-hard-drive.html" class="tags">cleaning up disk space on hard drive</a>
                    &nbsp;<a href="https://lofipython.com/tag/managing-linux-files.html" class="tags">managing linux files</a>
                    &nbsp;<a href="https://lofipython.com/tag/clearing-python-cache-and-libraries.html" class="tags">clearing python cache and libraries</a>
                </div>
            </article>            <h4 class="date">Feb 05, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/adding-city-name-autocomplete-to-a-django-form-with-jquery-ajax.html" rel="bookmark" title="Permanent Link to &quot;Adding City Name Autocomplete to a Django Form With jQuery + AJAX&quot;">Adding City Name Autocomplete to a Django Form With jQuery + AJAX</a>
                </h2>

                
                

                <p>Below is a slightly modified adaptation of the <a class="reference external" href="https://espere.in/Enhance-Your-Django-App:-Step-by-Step-Guide-to-Implementing-Autocomplete-Search-with-jQuery/">Espere.in Step By Step Guide</a>
by Abdulla Fajal. I needed to make a few changes to the code to get things to work.
I also expanded the example to show how I imported cities data to the Django model.
In this post, I'll show how you can use AJAX and <a class="reference external" href="https://jqueryui.com/autocomplete/">jQuery Autocomplete</a>
with a Django model to create a form with city auto-completion.</p>
<p><strong>Add a Model to models.py</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">city_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s2">&quot;País&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p><strong>Register the City Model in admin.py</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">City</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p><strong>Migrate the Django Model</strong></p>
<pre class="code console literal-block">
<span class="go">python manage.py makemigrations City
python manage.py migrate</span>
</pre>
<p><strong>Add Auto-complete TextInput() to forms.py</strong></p>
<p>The key items here are the &quot;id&quot; attribute holding the value &quot;search-input&quot; and
the &quot;name&quot; attribute with value &quot;city_name&quot;. Together, these values will tell jQuery
for which form element to render the autocomplete view and which model field you targeting
to fill into the autocomplete view.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">bookings.models</span> <span class="kn">import</span> <span class="n">Booking</span>

<span class="k">class</span> <span class="nc">BookingForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Booking</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;__all__&quot;</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span>
                <span class="n">attrs</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;form-control&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;search-input&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;city_name&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Type to search&quot;</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>
</pre></div></td></tr></table></div>
<p><strong>Download the World Cities Database from Simplemaps</strong></p>
<p>The <a class="reference external" href="https://simplemaps.com/data/world-cities">World Cities Database</a> basic version
is free and allowed for commercial use. In this example, this provides the cities data.</p>
<p><strong>Import the Cities Database to Django Model</strong></p>
<p>Now we need to import the cities to our Django model. I achieved this by running
the below code in the Django shell and entering each line individually. The code was
modified from a <a class="reference external" href="https://stackoverflow.com/questions/2459979/how-to-import-csv-data-into-django-models">Stack Overflow post</a>.
The World Cities data stores the city in the first column (index 0) and the country
in the 5th column (index 4).</p>
<pre class="code console literal-block">
<span class="go">python manage.py shell</span>
</pre>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>

<span class="n">City</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;bookings&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;City&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;worldcities.csv&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">City</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">country</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">],)</span>
</pre></div></td></tr></table></div>
<img alt="running Python in the Django shell" src="https://lofipython.com/images/djangoshell.png" />
<p><strong>View Your City Model in the Admin Panel</strong></p>
<p>Enter the below command to start your local Django development server. Then you
can go to <a class="reference external" href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a> in a web browser to see your model on the back-end.</p>
<pre class="code console literal-block">
<span class="go">python manage.py runserver</span>
</pre>
<p><strong>Add jQuery Scripts to HTML File</strong></p>
<p>Add the jquery import scripts to your HTML &lt;head&gt; tag.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="o">&lt;</span><span class="nx">link</span><span class="w"> </span><span class="nx">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s2">&quot;https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css&quot;</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span><span class="w"> </span><span class="nx">media</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="c">&lt;!--</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">jQuery</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">jQuery</span><span class="w"> </span><span class="nx">UI</span><span class="w"> </span><span class="nx">JavaScript</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://code.jquery.com/jquery-3.6.4.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">&quot;https://code.jquery.com/ui/1.12.1/jquery-ui.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</pre></div></td></tr></table></div>
<p>Add the jQuery autocomplete script to the bottom of your HTML. This is where we
reference the &quot;search-input&quot; id in our form and specify the url route &quot;/ajax_calls/search/&quot;.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#search-input&quot;</span><span class="p">).</span><span class="nx">autocomplete</span><span class="p">({</span>
<span class="w">        </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;/ajax_calls/search/&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">minLength</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">        </span><span class="nx">open</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(){</span>
<span class="w">            </span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.ui-autocomplete&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;z-index&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">99</span><span class="p">);</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div></td></tr></table></div>
<p><strong>Add the Autocomplete View to Views.py</strong></p>
<p>Note this script is using the <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest API</a>,
which is used in combination with <a class="reference external" href="https://en.wikipedia.org/wiki/Ajax_(programming)">AJAX</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">BookingForm</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays an HTML page with a form. If the request is a post, save the data to the DB.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
          <span class="c1"># Create a form instance and populate it with data from the request.</span>
          <span class="n">form</span> <span class="o">=</span> <span class="n">BookingForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
              <span class="n">new_booking</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
              <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/confirmation_page&quot;</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BookingForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;simple_django_form.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">autocomplete</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show the City model records via AJAX + jQuery.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x-requested-with&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;XMLHttpRequest&quot;</span><span class="p">:</span>
        <span class="n">City</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;bookings&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;City&quot;</span><span class="p">)</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">&quot;term&quot;</span><span class="p">]</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="n">City</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">city_name__startswith</span><span class="o">=</span><span class="n">term</span><span class="p">)</span>
        <span class="n">cities</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">city_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">country</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">cities</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span>
   <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">confirmation_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a confirmation page thanking the client for their business.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Thanks for signing up!&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p><strong>Write the HTML for a Simple Django Form</strong></p>
<p>Here is the template I used. It differs slightly from the <a class="reference external" href="https://docs.djangoproject.com/en/5.0/topics/forms/#the-template">template in the Django docs</a>.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="p">{</span><span class="o">%</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="s1">&#39;base.html&#39;</span><span class="w"> </span><span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="nx">form</span><span class="w"> </span><span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">{</span><span class="o">%</span><span class="w"> </span><span class="nx">csrf_token</span><span class="w"> </span><span class="o">%</span><span class="p">}</span>
<span class="w">    </span><span class="p">{{</span><span class="w"> </span><span class="nx">form</span><span class="p">.</span><span class="nx">as_p</span><span class="w"> </span><span class="p">}}</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nx">input</span><span class="w"> </span><span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span><span class="w"> </span><span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="p">{</span><span class="o">%</span><span class="w"> </span><span class="nx">endblock</span><span class="w"> </span><span class="o">%</span><span class="p">}</span>
</pre></div></td></tr></table></div>
<p><strong>Understanding Ajax + XMLHttpRequest</strong></p>
<blockquote>
Ajax is a technique that uses XMLHttpRequest to exchange data with a web server
without reloading the whole page. XMLHttpRequest is an object that allows web apps
to make HTTP requests and receive the responses programmatically using JavaScript.
Ajax stands for Asynchronous JavaScript and XML,  which means that the data exchange
can happen in the background, while the user interacts with the web page.
- Bing AI</blockquote>
<p><strong>Add the URL Route to urls.py</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;your_app_name&quot;</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;confirmation_page/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">confirmation_page</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;confirmation page&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;ajax_calls/search/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">autocomplete</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;city_autocomplete&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div></td></tr></table></div>
<p><strong>Voila! The City Autocomplete View</strong></p>
<img alt="adding autocomplete to a Django form with jQuery" src="https://lofipython.com/images/jQueryautocomplete.png" />
<p>Note: to achieve the appearance of the form text box and autocomplete dropdown, I installed
the <a class="reference external" href="https://django-bootstrap-v5.readthedocs.io/en/latest/">django-bootstrap-v5 python module</a></p>
<p>This felt very rewarding to see once it was working. I stretched my abilities
outside of coding only in Python to achieve this functionality in my website.
Someday I would like to be an experienced Javascript developer also. <a class="reference external" href="https://api.jquery.com/">jQuery</a> has
been a staple in web development for many years. Auto-complete is just one of the features
that this core Javascript library enables. I am definitely intrigued to explore jQuery further.</p>
<p>Want to read more about Django? Check out my
<a class="reference external" href="https://lofipython.com/first-impressions-and-key-concepts-of-the-django-python-web-framework">notes on Django here</a>.</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/adding-city-name-autocomplete-to-a-django-form-with-jquery-ajax.html">posted at 14:33</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-ajax-javascript-web-development.html" rel="tag">coding, programming, python, AJAX, Javascript, web development</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/making-a-city-autocomplete-form.html" class="tags">making a city autocomplete form</a>
                    &nbsp;<a href="https://lofipython.com/tag/how-to-make-django-autocomplete.html" class="tags">how to make django autocomplete</a>
                    &nbsp;<a href="https://lofipython.com/tag/integrating-django-and-jquery.html" class="tags">integrating Django and jQuery</a>
                </div>
            </article>            <h4 class="date">Feb 02, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/first-impressions-and-key-concepts-of-the-django-python-web-framework.html" rel="bookmark" title="Permanent Link to &quot;First Impressions and Key Concepts of the Django Python Web Framework&quot;">First Impressions and Key Concepts of the Django Python Web Framework</a>
                </h2>

                
                

                <p><strong>First Impressions of Django</strong></p>
<p>Picking up <a class="reference external" href="https://pypi.org/project/Django/">Django</a> felt right. In the past I used
other Python web frameworks like <a class="reference external" href="http://www.web2py.com/">web2py</a> and <a class="reference external" href="http://www.web2py.com/">flask</a>.
I mostly avoided Django before now because it felt a bit overkill for the smaller
toy apps I made in my beginning years as a Python developer. For example, this blog
is made with the <a class="reference external" href="https://getpelican.com/">Pelican</a> static site generator, a
choice which has served me well.</p>
<p>Recently, a project came my way that seemed a good fit to apply Django. The task
required building a travel booking website. For this use case, Django shined. It
fits like a glove on a seasoned Python programmer. I am impressed how quickly I
adapted to it and thrived as I made my minimum viable product website.</p>
<p>Kudos to the Django developers that I, a typical Python programmer
aided with artificial intelligence could rapidly develop using their tools to
achieve my goals. If I could learn to write some decent CSS, I'd be unstoppable!</p>
<p>I highly recommend all Python programmers pick Django for their web apps with more
robust requirements. I say this with no slight to fellow heavyweight Flask or other
popular Python web frameworks like <a class="reference external" href="https://www.tornadoweb.org/en/stable/">Tornado</a>,
<a class="reference external" href="https://bottlepy.org/docs/dev/">Bottle</a>, <a class="reference external" href="https://docs.cherrypy.dev/en/latest/">CherryPy</a>
or <a class="reference external" href="https://py4web.com/">py4web</a> . All of these can all be justified in the
right situation due to their unique capabilities. Django stands out because it's
pretty easy to reach for things that already exist in the library to get what you
need done. Other frameworks may require a more nuanced skillset to achieve the same results.
Ok, enough pontification. Here are my notes of key Django concepts.</p>
<p><strong>Start with the Django official tutorial.</strong></p>
<p>The tutorial is lengthy and starts from the ground up. I commend its thoroughness.
Start there and work your way out. <a class="reference external" href="https://docs.djangoproject.com/en/5.0/intro/tutorial01/">Django Documentation Tutorial</a></p>
<p><strong>Django Models, Forms &amp; Fields, models.py and forms.py</strong></p>
<p>Your forms.py and models.py files are crucial pieces to render a form, collect data
and store it in the database.</p>
<p><strong>manage.py</strong></p>
<p>This file is used for database model migrations, creating a new app and accessing
your app through the shell.</p>
<p><strong>views.py</strong></p>
<p>The views.py file contains the Python functions that execute the flow of your app.
Each function in the views.py can be a view.</p>
<p><strong>urls.py</strong></p>
<p>The urls.py defines your url schema so that when you go to &quot;example.com/any_page&quot;,
you can tell django which view to show there.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;bookings&quot;</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;hotels/&quot;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">hotels</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;hotels&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div></td></tr></table></div>
<p><strong>settings.py</strong></p>
<p>After you create your app structure with a django manage.py command, a settings.py is automatically generated.
You will need to make edits here occasionally, such as changing the value of debug
to true or false. You may need to add newly installed apps or make other changes
in your settings.py to get things to work.</p>
<p><strong>HTML + CSS Required</strong></p>
<p>Your HTML and CSS skills will come in handy when working with Django or any web framework.
This is not a big surprise. You almost always need to know HTML and CSS to mold
your website to your requirements.</p>
<p><strong>Django Template Language + Filters</strong></p>
<p>Django comes with its own <a class="reference external" href="https://docs.djangoproject.com/en/5.0/ref/templates/language/#the-django-template-language">HTML template language</a>
to help you dynamically populate values in HTML. You can also use its <a class="reference external" href="https://docs.djangoproject.com/en/5.0/ref/templates/builtins/">built-in template tags and filters</a>
to transform values directly in the HTML. Additionally, Django lets you write
<a class="reference external" href="https://docs.djangoproject.com/en/5.0/howto/custom-template-tags/">custom template tags and filters</a>
to use Python for more complex transformations or on the fly mathematic calculations.
Below is an example of how you can use Django's templating language to loop through
your Django model. Django has built-in support for if statements inside its HTML.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span>{% for hotel in hotels %}
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
{% if hotel.all_inclusive %}
    This hotel is all included.
{% else %}
    This hotel is not all included.
{% endif %}
<span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
{% if hotel.accepts_groups %}
    This hotel accepts groups.
{% else %}
    This hotel doesn&#39;t accept groups.
{% endif %}
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div></td></tr></table></div>
<p><strong>Javascript + jQuery Friendly</strong></p>
<p>Django seems fully capable of integrating with Javascript libraries. I was able
to get jQuery + AJAX request autocomplete functionality working in my form with
help from Bing's AI Chat. I followed along with this <a class="reference external" href="https://espere.in/Enhance-Your-Django-App:-Step-by-Step-Guide-to-Implementing-Autocomplete-Search-with-jQuery/">helpful blog post</a>
to get my jQuery script working!</p>
<img alt="adding autocomplete to a django form with jQuery" src="https://lofipython.com/images/jQueryautocomplete.png" />
<p><strong>External Django Python Libraries</strong></p>
<p>Another plus of Django due to its popularity is the amount of external modules that
Python developers have written to add features and functionality. For example,
<a class="reference external" href="https://django-autocomplete-light.readthedocs.io/en/master/tutorial.html">django-autocomplete-light</a>
and the <a class="reference external" href="https://pypi.org/project/django-bootstrap-v5/">django-bootstrap-v5</a>
CSS library are installed with pip. I successfully used django-bootstrap-v5 to add
bootstrap CSS styling to my website. Note this library requires a slightly older
version of Django.</p>
<p>Often there are several ways to get something done in Django, with external Python libraries
or Javascript libraries each a possibility to succeed. After several hours of
failing to get django-autocomplete-light working, I achieved the same result with
jQuery. It's always good to have options.</p>
<p><strong>The Admin Panel + admin.py</strong></p>
<p>One of the best out of the box features of Django is its admin panel and user model.
If you intend to build a website with for your users, this makes Django a great choice.
Don't forget to register your models in your admin.py.</p>
<p><strong>apps.get_model()</strong></p>
<p>You can import your models at the top of your code or use this handy convenience function to
retrieve it directly.</p>
<p><strong>model_to_dict()</strong></p>
<p>This is another function Django provides for converting a model object class to a Python dictionary.
Once a model is in dictionary format, you can pass it to a django form's &quot;initial&quot; argument
to easily auto-populate a form.</p>
<p><strong>request.GET()</strong></p>
<p>Django has its own request objects. You can pass a raw query string to HttpResponseRedirect.
Then, in the view of the target page, you can use this function to get the querystring
value by passing its key.</p>
<p><strong>render() and contexts</strong></p>
<p>The render function renders an HTML document. This function has a context argument
that allows you to pass variables into the HTML view.</p>
<p><strong>How to Install Django</strong></p>
<pre class="code console literal-block">
<span class="go">pip install Django</span>
</pre>
<p><strong>Django Views.py Code Example</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">apps</span>
<span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">forms</span> <span class="kn">import</span> <span class="n">BookingForm</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays an HTML page with a form. If the request is a post, save the data</span>
<span class="sd">    to the DB. If booking_id is passed in the url querystring, populate the form</span>
<span class="sd">    with data from that id.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
          <span class="c1"># Create a form instance and populate it with data from the request.</span>
          <span class="n">form</span> <span class="o">=</span> <span class="n">BookingForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
              <span class="n">new_booking</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
              <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/hotels?booking_id=</span><span class="si">{</span><span class="n">new_booking</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">booking_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">&quot;booking_id&quot;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">booking_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">booking_id</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
        <span class="n">Booking</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;your_app_name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Booking&quot;</span><span class="p">)</span>
        <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">booking_id</span><span class="p">)</span>
        <span class="n">booking_dict</span> <span class="o">=</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="n">booking</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">booking_dict</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BookingForm</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">booking_dict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BookingForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;simple_django_form.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">hotels</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a list of hotels to for clients to view from the Hotel model.&quot;&quot;&quot;</span>
    <span class="n">booking_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="p">[</span><span class="s2">&quot;booking_id&quot;</span><span class="p">]</span>
    <span class="n">Booking</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;your_app_name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Booking&quot;</span><span class="p">)</span>
    <span class="n">booking</span> <span class="o">=</span> <span class="n">Booking</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">booking_id</span><span class="p">)</span>
    <span class="n">Hotel</span> <span class="o">=</span> <span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">app_label</span><span class="o">=</span><span class="s2">&quot;your_app_name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;Hotel&quot;</span><span class="p">)</span>
    <span class="n">hotels</span> <span class="o">=</span> <span class="n">Hotel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">city__contains</span><span class="o">=</span><span class="n">booking</span><span class="o">.</span><span class="n">to_city</span><span class="p">)</span>
    <span class="c1"># Pass context to access variables directly in hotels.html: {{ return_date }}</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;hotels&quot;</span><span class="p">:</span> <span class="n">hotels</span><span class="p">,</span>
        <span class="s2">&quot;booking_id&quot;</span><span class="p">:</span> <span class="n">booking_id</span><span class="p">,</span>
        <span class="s2">&quot;departure_date&quot;</span><span class="p">:</span> <span class="n">booking</span><span class="o">.</span><span class="n">departure_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
        <span class="s2">&quot;return_date&quot;</span><span class="p">:</span> <span class="n">booking</span><span class="o">.</span><span class="n">return_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
        <span class="s2">&quot;to_city&quot;</span><span class="p">:</span> <span class="n">booking</span><span class="o">.</span><span class="n">to_city</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;hotels.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p><strong>Basic Model Example</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Booking</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">departure_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s2">&quot;departure date&quot;</span><span class="p">)</span>
    <span class="n">return_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s2">&quot;return date&quot;</span><span class="p">)</span>
    <span class="n">from_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">to_city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s2">&quot;Destino&quot;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Hotel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">all_inclusive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s2">&quot;hotels&quot;</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<p>Hopefully this helped you get started with Django. In my own experience, once you
get some momentum going with this web framework, you'll progress rapidly!</p>
<p><strong>Supplementary Django Links</strong></p>
<p><a class="reference external" href="https://docs.djangoproject.com/en/5.0/ref/forms/fields/">Django Form Fields Reference</a></p>
<p><a class="reference external" href="https://docs.djangoproject.com/en/5.0/ref/models/fields/">Django Model Fields Reference</a></p>
<p><a class="reference external" href="https://docs.djangoproject.com/en/5.0/ref/settings/">Django Settings Reference</a></p>
<p><a class="reference external" href="https://docs.djangoproject.com/en/5.0/howto/">Django How-to Guides</a></p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/first-impressions-and-key-concepts-of-the-django-python-web-framework.html">posted at 12:33</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-django-web-development.html" rel="tag">coding, programming, python, django, web development</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/django-web-framework.html" class="tags">django web framework</a>
                    &nbsp;<a href="https://lofipython.com/tag/building-websites-with-django-python.html" class="tags">building websites with django python</a>
                    &nbsp;<a href="https://lofipython.com/tag/getting-started-with-a-django-app.html" class="tags">getting started with a django app</a>
                </div>
            </article>            <h4 class="date">Jan 15, 2024</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://lofipython.com/python-pandas-api-oddities.html" rel="bookmark" title="Permanent Link to &quot;Python Pandas API Oddities&quot;">Python Pandas API Oddities</a>
                </h2>

                
                

                <p>Below I've highlighted some niche functions in Python's pandas library. I've plucked
a few examples from the pandas documentation and the
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Delta_Air_Lines_destinations">Delta Airlines Airports Wikipedia HTML table</a>
for sample data. This post is aimed at the more advanced stuff on the fringes of the pandas docs.
Here are some oddities of the less traveled parts of the pandas documentation.
You never know what you'll find there, it's always evolving. Images were sourced
from the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/general_functions.html#importing-from-other-dataframe-libraries">pandas documentation</a>.</p>
<p><strong>Install pandas + lxml</strong></p>
<p>Install Python dependencies with pip: pandas and lxml, required for read_html()</p>
<pre class="literal-block">
python3.12 -m pip install pandas
python3.12 -m pip install lxml
</pre>
<p><strong>What's Not Mentioned Here</strong></p>
<p>I skipped the standard must know functions like <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">pd.read_csv()</a>,
pd.read_excel(), pd.DataFrame.to_csv(), <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_json.html">pd.DataFrame.to_json()</a>
and so on. The documentation on these functions is extensive. I recommend checking
out all the ways you can customize behavior of your data with their arguments.</p>
<p><strong>pd.DataFrame.__dataframe__() + pd.api.interchange.from_dataframe()</strong></p>
<p>Import a DataFrame from another library via the <a class="reference external" href="https://data-apis.org/dataframe-protocol/latest/index.html">DataFrame interchange protocol</a>.
The .__dataframe__() dunder method returns an interchange object which can be used to
convert another dialect of dataframe to pandas. If the protocol is supported,
a dataframe interchange object has the methods &quot;column_names&quot; and &quot;select_columns_by_name&quot;.
If you're dealing with a flavor of dataframe other than pandas, keep in mind it may support
the DataFrame interchange protocol.</p>
<img alt="interchange dataframes between libraries" src="https://lofipython.com/images/pandasdataframeinterchangeprotocol.png" />
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.interchange.from_dataframe.html#pandas.api.interchange.from_dataframe">pandas.api.interchange.from_dataframe() documentation</a></p>
<img alt="get a dataframe interchange object" src="https://lofipython.com/images/dunderdataframepandasapi.png" />
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.__dataframe__.html">pandas interchange object documentation</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_not_necessarily_pandas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
<span class="n">interchange_object</span> <span class="o">=</span> <span class="n">df_not_necessarily_pandas</span><span class="o">.</span><span class="n">__dataframe__</span><span class="p">()</span>
<span class="n">df_pandas</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interchange</span><span class="o">.</span><span class="n">from_dataframe</span>
           <span class="p">(</span><span class="n">interchange_object</span><span class="o">.</span><span class="n">select_columns_by_name</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">])))</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
&gt;&gt;&gt; df_pandas

     A
0    1
1    2

&gt;&gt;&gt; interchange_object.column_names()

Index(['A', 'B'], dtype='object')
</pre>
<p><strong>pd.read_html(url)</strong></p>
<p>pd.read_html() accepts a website url. It returns a list of all HTML tables
as DataFrames. After getting the table as a dataframe, use &quot;.drop()&quot; to drop a column and &quot;.fillna()&quot;
to fill NA values as blanks. <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.read_html.html">read_html() Documentation</a></p>
<img alt="read an HTML table to pandas dataframe" src="https://lofipython.com/images/readhtmlpandas.png" />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://en.wikipedia.org/wiki/List_of_Delta_Air_Lines_destinations&quot;</span>
<span class="n">airports</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Drop the irrelevant &quot;Refs&quot; column and fill nans blank.</span>
<span class="n">airports</span> <span class="o">=</span> <span class="n">airports</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;Refs&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">airports</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div></td></tr></table></div>
<p><strong>pd.DataFrame.to_html()</strong></p>
<p>This function returns your tabular data as an HTML string.
df.head() accepts a number and returns a df with that many records, in this case 2.
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_html.html">to_html() Documentation</a></p>
<img alt="convert dataframe to HTML table with pandas" src="https://lofipython.com/images/tohtmlpandas.png" />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><span class="n">html</span> <span class="o">=</span> <span class="n">airports</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
  &lt;thead&gt;
    &lt;tr style=&quot;text-align: right;&quot;&gt;
      &lt;th&gt;Country / Territory&lt;/th&gt;
      &lt;th&gt;City&lt;/th&gt;
      &lt;th&gt;Airport&lt;/th&gt;
      &lt;th&gt;Notes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Antigua and Barbuda&lt;/td&gt;
      &lt;td&gt;Osbourn&lt;/td&gt;
      &lt;td&gt;V. C. Bird International Airport&lt;/td&gt;
      &lt;td&gt;Seasonal&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Argentina&lt;/td&gt;
      &lt;td&gt;Buenos Aires&lt;/td&gt;
      &lt;td&gt;Ministro Pistarini International Airport&lt;/td&gt;
      &lt;td&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
</pre>
<img alt="example pandas HTML table" src="https://lofipython.com/images/htmltable.png" />
<p><strong>pd.DataFrame.memory_usage()</strong></p>
<p>Returns the memory usage of each column in bytes. Per the docs, &quot;this value is displayed in DataFrame.info by default.&quot;
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.memory_usage.html">.memory_usage() Documentation</a></p>
<img alt="see bytes size for each column" src="https://lofipython.com/images/memoryusagepandasapi.png" />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># To include memory footprint of object dtypes, pass deep=True.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">airports</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
Index                    132
Country / Territory    24125
City                   21164
Airport                30660
Notes                  19237
dtype: int64
</pre>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="k">def</span> <span class="nf">readable_format</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a bytes integer to a human-readable format.</span>

<span class="sd">    Args:</span>
<span class="sd">        size (int): The bytes integer to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The human-readable format of the bytes integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;KB&quot;</span><span class="p">,</span> <span class="s2">&quot;MB&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">,</span> <span class="s2">&quot;TB&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">size</span> <span class="o">/=</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> PB&quot;</span>

<span class="c1"># Use pd.Series.apply() to convert bytes to &quot;human readable&quot; data format.</span>
<span class="n">memory_usage</span> <span class="o">=</span> <span class="n">airports</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">readable_format</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">memory_usage</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
Index                  132.00 B
Country / Territory    24.12 KB
City                   21.16 KB
Airport                30.66 KB
Notes                  19.24 KB
dtype: object
</pre>
<p><strong>pd.DataFrame.empty</strong></p>
<p>Every pandas DataFrame has a &quot;.empty&quot; attribute. If Series/DataFrame is empty,
returns True, if not returns False. <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.empty.html">.empty Documentation</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">airports</span><span class="o">.</span><span class="n">empty</span><span class="p">)</span>
<span class="c1"># False</span>
<span class="k">if</span> <span class="n">airports</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame has no data.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame contains data.&quot;</span><span class="p">)</span>
<span class="c1"># DataFrame contains data.</span>
</pre></div></td></tr></table></div>
<p><strong>pd.DataFrame.T</strong></p>
<p>Every pandas DataFrame has a &quot;.T&quot; attribute. It returns the transposed version
of the DataFrame. <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.T.html#pandas.DataFrame.T">.T Documentation</a></p>
<pre class="literal-block">
&gt;&gt;&gt; airports.head(3).T
</pre>
<pre class="literal-block">
  0                                         1                                    2
Country / Territory               Antigua and Barbuda                                 Argentina                                Aruba
City                                          Osbourn                              Buenos Aires                           Oranjestad
Airport              V. C. Bird International Airport  Ministro Pistarini International Airport  Queen Beatrix International Airport
Notes                                        Seasonal
</pre>
<p><strong>pd.DataFrame.convert_dtypes() + .infer_objects()</strong></p>
<p>These are 2 functions for swiftly handling data types in your tabular data.
Note: these are alternatives to the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.astype.html">&quot;astype()&quot; function</a>, which is used more commonly.
Use astype() to set a column or dataframe to a specific dtype. Use infer_objects() to
infer more suitable types for object columns. Use convert_dtypes() to let pandas choose the best possible dtype.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="c1"># Convert columns to the best possible dtypes using dtypes supporting pd.NA.</span>
<span class="n">typed_df</span> <span class="o">=</span> <span class="n">airports</span><span class="o">.</span><span class="n">convert_dtypes</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">typed_df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

<span class="c1"># Attempt to infer better dtypes for object columns.</span>
<span class="n">inferred_df</span> <span class="o">=</span> <span class="n">airports</span><span class="o">.</span><span class="n">infer_objects</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inferred_df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
&gt;&gt;&gt; airports.head()
  Country / Territory          City                                   Airport       Notes
0  Antigua and Barbuda       Osbourn          V. C. Bird International Airport    Seasonal
1            Argentina  Buenos Aires  Ministro Pistarini International Airport
2                Aruba    Oranjestad       Queen Beatrix International Airport
3            Australia        Sydney                            Sydney Airport
4              Austria        Vienna              Vienna International Airport  Terminated

&gt;&gt;&gt; airports.dtypes
Country / Territory    object
City                   object
Airport                object
Notes                  object
dtype: object

&gt;&gt;&gt; typed_df.dtypes
Country / Territory    string[python]
City                   string[python]
Airport                string[python]
Notes                  string[python]
dtype: object

&gt;&gt;&gt; inferred_df.dtypes
Country / Territory    object
City                   object
Airport                object
Notes                  object
dtype: object
</pre>
<p><a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.convert_dtypes.html">convert_dtypes Documentation</a>
+ <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.convert_dtypes.html">infer_objects() Documentation</a></p>
<p><strong>pd.Series.str.get(index)</strong></p>
<p>str.get() is available via the pandas Series string accessor.
This function is useful when your dataset contains a column holding a list in each cell.
It also works on strings by returning the character at the index of a string.
You can pass an index and that value will be returned for each cell in a column.
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.get.html#pandas-series-str-get">str.get() Documentation</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;String&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">],</span> <span class="mi">123</span><span class="p">,</span> <span class="o">-</span><span class="mi">456</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;World&quot;</span><span class="p">}]</span>
<span class="p">)</span>
<span class="n">new_column</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_column</span><span class="p">)</span>
</pre></div></td></tr></table></div>
<pre class="literal-block">
&gt;&gt;&gt; s
0                        String
1                     (1, 2, 3)
2                     [a, b, c]
3                           123
4                          -456
5    {1: 'Hello', '2': 'World'}
dtype: object

&gt;&gt;&gt; s.str.get(1)
0        t
1        2
2        b
3      NaN
4      NaN
5    Hello
dtype: object
</pre>
<p><strong>Pique Your Curiosity With Pandas</strong></p>
<p>Now you know a few of my favorite pandas API oddities. It's always time
well spent reading the <a class="reference external" href="https://pandas.pydata.org/">Pandas API documentation</a>.
Check out <a class="reference external" href="https://lofipython.com/pandas-pythons-excel-powerhouse">this other post I wrote about pandas</a>
for a deeper dive into this powerful Python module.</p>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://lofipython.com/python-pandas-api-oddities.html">posted at 17:41</a>
                    &nbsp;&middot;&nbsp;<a href="https://lofipython.com/category/coding-programming-python-pandas.html" rel="tag">coding, programming, python, pandas</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://lofipython.com/tag/pandas-api.html" class="tags">pandas api</a>
                    &nbsp;<a href="https://lofipython.com/tag/using-pandas-in-python.html" class="tags">using pandas in Python</a>
                    &nbsp;<a href="https://lofipython.com/tag/working-with-data.html" class="tags">working with data</a>
                    &nbsp;<a href="https://lofipython.com/tag/how-to-use-pandas.html" class="tags">how to use pandas</a>
                    &nbsp;<a href="https://lofipython.com/tag/reading-html-with-pandas.html" class="tags">reading HTML with pandas</a>
                    &nbsp;<a href="https://lofipython.com/tag/reading-pandas-memory-usage.html" class="tags">reading pandas memory usage</a>
                </div>
            </article>

                <div class="clear"></div>
                <div class="pages">


                    <a href="https://lofipython.com/index2.html" class="next_page">Next&nbsp;&rarr;</a>

                    <span>Page 1 of 13</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/tcarwash/blue-penguin-dark">Blue Penguin Dark</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://lofipython.com/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
                &middot;
                <a href="https://lofipython.com/feeds/all.rss.xml" rel="alternate">Rss Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>