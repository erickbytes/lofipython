<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Python Marketer - rpc</title><link href="https://pythonmarketer.com/" rel="alternate"></link><link href="https://pythonmarketer.com/feeds/rpc.tag.atom.xml" rel="self"></link><id>https://pythonmarketer.com/</id><updated>2020-07-15T00:24:00-05:00</updated><entry><title>Benefits of Go and Threads in Distributed Systems</title><link href="https://pythonmarketer.com/benefits-of-go-and-threads-in-distributed-systems.html" rel="alternate"></link><published>2020-07-15T00:24:00-05:00</published><updated>2020-07-15T00:24:00-05:00</updated><author><name>pythonmarketer</name></author><id>tag:pythonmarketer.com,2020-07-15:/benefits-of-go-and-threads-in-distributed-systems.html</id><summary type="html">&lt;p&gt;&lt;strong&gt;Preface&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;These are my &lt;a href="https://www.youtube.com/watch?v=gA4YXUJX7t8&amp;amp;list=PLrw6a1wE39_tb2fErI4-WkMbsvGQk9_UB&amp;amp;index=3&amp;amp;t=0s"&gt;YouTube lecture&lt;/a&gt; notes from MIT's Distributed Systems course. Thank you MIT and Professor Morris!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class="yt-simple-endpoint style-scope yt-formatted-string" href="https://www.youtube.com/playlist?list=PLrw6a1wE39_tb2fErI4-WkMbsvGQk9_UB"&gt;MIT 6.824 Distributed Systems&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Lecture 2: RPC and Threads - Feb 7, 2020&lt;/p&gt;
&lt;p&gt;Prof. Robert Morris (Spring 2020)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Introduction&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Go is a popular programming language choice so my ears perked up when â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;Preface&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;These are my &lt;a href="https://www.youtube.com/watch?v=gA4YXUJX7t8&amp;amp;list=PLrw6a1wE39_tb2fErI4-WkMbsvGQk9_UB&amp;amp;index=3&amp;amp;t=0s"&gt;YouTube lecture&lt;/a&gt; notes from MIT's Distributed Systems course. Thank you MIT and Professor Morris!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class="yt-simple-endpoint style-scope yt-formatted-string" href="https://www.youtube.com/playlist?list=PLrw6a1wE39_tb2fErI4-WkMbsvGQk9_UB"&gt;MIT 6.824 Distributed Systems&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Lecture 2: RPC and Threads - Feb 7, 2020&lt;/p&gt;
&lt;p&gt;Prof. Robert Morris (Spring 2020)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Introduction&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Go is a popular programming language choice so my ears perked up when this lecture began. These notes were taken as the professor explains why he teaches his class in Go. He also mentioned he'd be able to teach it with Python or Java. He used C++ years ago.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;The beginning of this lecture was a great summary of:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;key benefits of Golang&lt;/li&gt;
&lt;li&gt;what threads are and why they're great&lt;/li&gt;
&lt;li&gt;how Go, threads and async tie together&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Go is Good for Distributed Systems&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Go is concurrency-friendly. With concurrent threads, you can effectively split a task such as making web requests to a server into many threads, completing them simultaneously.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Golang's Convenient Features and Benefits&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;convenient &lt;a href="https://golang.org/pkg/net/rpc/"&gt;Remote Procedure Call library&lt;/a&gt; (&lt;a href="https://en.wikipedia.org/wiki/Remote_procedure_call"&gt;RPC&lt;/a&gt;) C++ lacks anything comparable?&lt;/li&gt;
&lt;li&gt;"Go is type-safe and memory-safe, unlike C++"&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)"&gt;garbage collection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;"the language is simple, unlike C++"&lt;/li&gt;
&lt;li&gt;"good support for threads, &lt;a href="https://en.wikipedia.org/wiki/Lock_(computer_science)"&gt;locking&lt;/a&gt; and synchronization between threads"&lt;/li&gt;
&lt;li&gt;in Go, "&lt;a href="https://golang.org/doc/effective_go.html#goroutines"&gt;goroutines&lt;/a&gt;" are threads&lt;/li&gt;
&lt;li&gt;professor's recommended reading to learn Go: &lt;a href="https://golang.org/doc/effective_go.html"&gt;Effective Go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;*Why use threads?&lt;/em&gt;&lt;/strong&gt;*&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I/O Concurrency&lt;/li&gt;
&lt;li&gt;Multi-core &lt;a href="https://en.wikipedia.org/wiki/Parallel_computing#:~:text=Parallel%20computers%20can%20be%20roughly,work%20on%20the%20same%20task."&gt;Parallelism&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Convenience, e.g. "create 10 threads that sleep for a second and then do a little bit of work"&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;"Threads are the main tool we're using to manage concurrency in programs."&lt;/p&gt;
&lt;p&gt;-Prof. Robert Morris&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Contrast With &lt;a href="https://en.wikipedia.org/wiki/Event-driven_programming#:~:text=In%20computer%20programming%2C%20event%2Ddriven,from%20other%20programs%20or%20threads."&gt;Event-driven Programming&lt;/a&gt; ("Asynchronomous")&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;A single thread, single loop that waits for an event.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Combining Threads and Event Driven Programming&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"Create one thread for each procedure call."... "On each of the threads run a stripped down event driven loop. Sort of one event loop per core. That results in parallelism and I/O concurrency."&lt;/p&gt;
&lt;p&gt;-Prof. Robert Morris&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;Postface: Concurrent Python Context&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I've rarely if ever used multiple threads in Python. Simply running a single threaded script seems sufficient for most of my tasks. Maybe I could speed up API requests by splitting into threads when making a few hundred thousand requests? Apparently I'm missing out on concurrent threading efficiency gains.&lt;/p&gt;
&lt;p&gt;I once experimented with the &lt;a href="https://docs.python.org/3.8/library/multiprocessing.html"&gt;multiprocessing&lt;/a&gt; module's &lt;a href="https://docs.python.org/3.8/library/multiprocessing.html#the-process-class"&gt;Process class&lt;/a&gt;, which worked on Linux but not Windows for me. I ended up taking an simpler, single thread approach instead. I've also heard of using multiprocessing &lt;a href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool"&gt;pool&lt;/a&gt; objects. There's also the &lt;a href="https://docs.python.org/3/library/asyncio.html"&gt;asyncio&lt;/a&gt; library &lt;a href="https://docs.python.org/3/library/concurrent.futures.html"&gt;concurrent.futures&lt;/a&gt; modules to consider. The &lt;a href="https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor-example"&gt;ProcessPoolExecutor&lt;/a&gt; looks promising.&lt;/p&gt;
&lt;p&gt;Python also has the &lt;a href="https://docs.python.org/3/library/queue.html"&gt;queue module.&lt;/a&gt; I haven't used it yet but at one point I watched a talk where &lt;a href="https://www.youtube.com/watch?v=_GP9OpZPUYc"&gt;Raymond Hettinger&lt;/a&gt; recommended queue as a good option if you want concurrency in Python.&lt;/p&gt;
&lt;p&gt;It seems there are many options available in Python but it's not clear which tools should be deployed and when. And your chosen concurrency strategy may add extra complexity. Handle with care. Or consider learning Go if you want to use threads to scale your distributed system.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update: Python Concurrency Success&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I recently deployed the &lt;a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor"&gt;ThreadPoolExecutor&lt;/a&gt; from the concurrent.futures module to efficiently move thousands of files to a new folder. So Python does have fairly accessible alternatives to concurrency. I guess I'll need to try Go sometime to compare!&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- wp:syntaxhighlighter/code --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;concurrent.futures&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ThreadPoolExecutor&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;shutil&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;Move files concurrently from the &lt;/span&gt;
&lt;span class="sd"&gt;current working directory to a new folder.&lt;/span&gt;

&lt;span class="sd"&gt;This script is adapted from the Python &lt;/span&gt;
&lt;span class="sd"&gt;ThreadPoolExecutor documentation:&lt;/span&gt;
&lt;span class="sd"&gt;https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Executor.shutdown&lt;/span&gt;

&lt;span class="sd"&gt;disclaimer: I am new to concurrency. Not 100% sure &lt;/span&gt;
&lt;span class="sd"&gt;if I am using the ThreadPoolExecutor correctly &lt;/span&gt;
&lt;span class="sd"&gt;but it seems to work, by moving my files concurrently and fast.&lt;/span&gt;
&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;csvs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcwd&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.csv&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;split_num&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;csvs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;file_batches&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;np&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="kp"&gt;array_split&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;csvs&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;split_num&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;ThreadPoolExecutor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_workers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;enumerate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;file_batches&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;csv_A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_D&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;files&lt;/span&gt;
            &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_A&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dst_folder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_B&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dst_folder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dst_folder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;submit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shutil&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;csv_D&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;dst_folder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;&amp;lt;!-- /wp:syntaxhighlighter/code --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Additional Reading&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- /wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://opensource.googleblog.com/2020/08/new-case-studies-about-googles-use-of-go.html?utm_source=feedburner&amp;amp;utm_medium=feed&amp;amp;utm_campaign=Feed%3A+GoogleOpenSourceBlog+%28Google+Open+Source+Blog%29"&gt;New Case Studies About Google's Use of Go&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- /wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://go.dev/"&gt;go.dev&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;!-- /wp:paragraph --&amp;gt;&lt;/code&gt;&lt;/p&gt;</content><category term="coding, concurrency, data, education, Go, lectures notes, programming"></category><category term="computers"></category><category term="distributed systems"></category><category term="golang"></category><category term="MIT"></category><category term="python"></category><category term="rpc"></category></entry></feed>