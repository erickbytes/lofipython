<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python Marketer | articles tagged "data analysis"</title>
    <link rel="shortcut icon" type="image/png" href="../favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
    <link href="https://pythonmarketer.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Python Marketer Full Atom Feed" />
    <link href="https://pythonmarketer.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Python Marketer Full RSS Feed" />
    <link href="https://pythonmarketer.com/feeds/data-analysis.tag.atom.xml" type="application/atom+xml" rel="alternate" title="Python Marketer Tags Atom Feed" />
    <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="../theme/css/pygments.css" type="text/css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="@erickbytes" />
</head>
<body>
    <header>
        <nav style="overflow: hidden;">
            <ul>
                <li class="ephemeral selected"><a href="../tag/data-analysis.html">data analysis</a></li>
                <li><a href="../">Home</a></li>
                <li><a href="feeds/all.rss.xml">RSS</a></li>
                <li><a href="feeds/all.atom.xml">Atom</a></li>
                <li><a href="https://github.com/erickbytes/divbull">Github</a></li>
            </ul>
        </nav>
        <div class="header_box" style="height: 50px">
        <h1><a href="../">
            <image src='images/python-powered-h-140x182.png' class="avatar" width="50px" /><span class="site_title">Python Marketer</span>
            </a></h1></div>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Apr 12, 2019</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../datasets-plotting-using-jupyter-pandas-and-matplotlib.html" rel="bookmark" title="Permanent Link to &quot;Plotting Datasets Using Jupyter, Pandas and Matplotlib&quot;">Plotting Datasets Using Jupyter, Pandas and Matplotlib</a>
                </h2>

                
                

                <p>I'm new to exploring datasets, but I've already found some great public data online. First, can I say that <a href="https://toolbox.google.com/datasetsearch">Google Dataset Search</a> is great? I have been enjoying many of the datasets I've found there. Additionally, organizations with public data like the <a href="https://data.cityofchicago.org/">Chicago Data Portal</a> are interesting to check out. I'm happy to live in a city that provides a lot of its data online for free. Do you know if your city has public data available? I discovered some of this data via sites like <a href="http://data.world">data.world</a> as well. With playful curiosity and the tools in this article, you will be well equipped to mine insights from any data.<a href="https://toolbox.google.com/datasetsearch"><img alt="screencapture-toolbox-google-datasetsearch-2019-04-11-07_47_50" class="alignleft size-full wp-image-1736" height="295" src="http://pythonmarketer.files.wordpress.com/2019/04/de1c3-screencapture-toolbox-google-datasetsearch-2019-04-11-07_47_50-e1555047601227.png" width="917"></a></p>
<p><strong>Below, I will highlight three datasets that I recently stumbled into.</strong></p>
<ol>
<li>Chicago Red Light Camera Violation Data</li>
<li>USDA Nutritional Data (2015)</li>
<li>Job Computerisation Forecast Data</li>
</ol>
<h2>Installation and Startup</h2>
<p>**New to Jupyter, pandas or pip? **</p>
<p>Welcome to the club. If you need a run-down on using pip, I wrote <a href="https://pythonmarketer.wordpress.com/2018/01/20/how-to-python-pip-install-new-libraries/">this post</a> to help sort it out. If you want a superb, gentle and funny introduction to pandas, Jupyter, and data analysis, <a href="https://www.youtube.com/watch?v=5JnMutdy6Fw">this PyCon session</a> is the best tutorial I have found, by far.</p>
<p><strong>To run the scripts shown in this post, you must:</strong> (1) install the three libraries below to run in a Jupyter notebook (recommended) <strong>OR</strong> (2) run these plots from the command line and view them as a saved image. To do that, just install pandas and matplotlib.</p>
<p><strong>First, <a href="https://docs.python.org/3/installing/index.html">install libraries with pip</a>. Enter in command prompt or terminal:</strong></p>
<ol>
<li>
<p>python -m pip install pandas</p>
</li>
<li>
<p>python -m pip install matplotlib</p>
</li>
<li>
<p>python3 -m pip install jupyter</p>
</li>
</ol>
<p><strong>Then, run Jupyter Notebook</strong></p>
<div class="highlight"><pre><span></span><code>jupyter notebook
</code></pre></div>

<h2>1. <a href="https://data.cityofchicago.org/Transportation/Red-Light-Camera-Violations/spqx-js37">Chicago Red Light Camera Violations (2014 - 2019)</a></h2>
<p><em>Note the spikes in tickets per day in 2016 and 2017, and the amount of tickets issued in 2016.  Less tickets were issued in 2017 and 2018, after more allegations surfaced about this troublesome red light camera program. Jupyter Notebook with code for both these charts can be found <a href="https://github.com/erickbytes/Dataset-Analysis-Notebooks/blob/master/Chicago%20Red%20Light%20Camera%20Tickets%20(2014-2019)/Chicago%20Red%20Light%20Violations.ipynb">here</a>.</em></p>
<p><img alt="Chicago Traffic Violations Per Day" class="wp-image-1751 alignleft" height="306" src="https://pythonmarketer.files.wordpress.com/2019/04/chicago-traffic-violations-per-day-1.png" width="322"></p>
<p><img alt="Chicago Red Light Violations By Year" class="wp-image-1745 alignright" height="207" src="https://pythonmarketer.files.wordpress.com/2019/04/chicago-red-light-violations-by-year.png" style="padding-bottom:20px;" width="323"></p>
<p><strong>Chicago's Shady Red Light Camera Program</strong></p>
<p>[2,573,339 violations occurred from July 2014 - March 2019. Personally, I was issued 3 red light camera tickets over the last 5 years. I charted out the tickets by year, month and day.  ]{style="color:var(--color-neutral-600);"}[The below code was used for the left image above, in which I plotted each day of red light camera violations in Chicago over the past 5 years.]{style="color:var(--color-neutral-600);"}</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">plotting red light tickets with matplotlib - Python Marketer</span>
<span class="sd">https://atomic-temporary-107329037.wpcomstaging.com/2019/04/12/datasets-plotting-using-jupyter-pandas-and-matplotlib/</span>
<span class="sd">matplotlib.plot_date docs: https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.plot_date.html </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Red_Light_Camera_Violations.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;VIOLATION DATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;VIOLATION DATE&#39;</span><span class="p">])</span>

<span class="sd">&quot;&quot;&quot;Applying Plot Formatting&quot;&quot;&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">YearLocator</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
<span class="n">red_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;DarkRed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Each Dot is 1 Day&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">red_patch</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-small&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>

<span class="sd">&quot;&quot;&quot;Pass pandas columns to plt.plot_date to create and save plot.&quot;&quot;&quot;</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;VIOLATIONS&#39;</span><span class="p">]</span> 
<span class="n">dates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;VIOLATION DATE&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot_date</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> 
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;DarkRed&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Chicago Red Light Ticket Violations - Past 5 Years&#39;</span><span class="p">,</span> 
          <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Chicago traffic Violations By Year.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Analysis:</strong> We can see 2016 is the leader for the past 5 years in amount of violations that occurred. The city of Chicago has drawn criticism for unethical practices in its camera program to reap more revenue. In 2017, the city approved a settlement of "nearly \$40 million after a previous class-action lawsuit alleged that the program had violated 1.2 million motorists’ due process rights." (<a href="https://www.illinoispolicy.org/lawsuit-claims-chicago-red-light-cameras-violate-state-law/">Source</a>)</p>
<blockquote>
<p>"A Tribune analysis of more than 4 million tickets issued since 2007 and a deeper probe of individual cases reveal clear evidence that a series of sudden, unexplainable spikes in Chicago's network of 380 cameras were caused by faulty equipment, human tinkering or both. Chicago transportation officials say they had no knowledge of the wild swings in ticketing until they were told by the Tribune — even though City Hall legally required the camera vendor to watch for the slightest anomaly in ticketing patterns every day. Many of the spikes lasted weeks." (<a href="http://graphics.chicagotribune.com/news/local/red-light-timeline/">Source</a>)</p>
</blockquote>
<p><a href="https://github.com/erickbytes/Dataset-Analysis-Notebooks/blob/master/Chicago%20Red%20Light%20Camera%20Tickets%20(2014-2019)/Chicago%20Red%20Light%20Violations.ipynb">See Full Jupyter Notebook</a></p>
<h2><a href="https://www.ars.usda.gov/northeast-area/beltsville-md-bhnrc/beltsville-human-nutrition-research-center/nutrient-data-laboratory/docs/sr28-download-files/">2. USDA Nutritional Data (2015)</a></h2>
<p>This USDA data was updated in 2015. It provides many common foods and their nutrient levels, such as carbohydrates and iron, for breads, fruits, vegetables, beverages and most foods you can find in a grocery store. I decided to see which foods contained the most: Sugar, Catbohydrates and Iron. The pandas <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.nlargest.html">nlargest</a> method made this a breeze.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;ABBREV.xlsx&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Sugar_Tot_(g)&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Shrt_Desc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="s1">&#39;CEREALS,&#39;</span><span class="p">,</span> 
                                  <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Sugar_Tot_(g)&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Shrt_Desc&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Sugar_Tot_(g)&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;DarkBlue&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Grams of Sugar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Foods&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Most Sugar, Cereals - USDA&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
</code></pre></div>

<blockquote>
<p>*<em>"Research suggests that as many as 80 percent of people in the world don't have enough iron in their bodies." </em>-World Health Organization ***</p>
</blockquote>
<p><img alt="Foods with The Most Iron - USDA" class="alignnone size-full wp-image-1754" height="279" src="https://pythonmarketer.files.wordpress.com/2019/04/foods-with-the-most-iron-usda.png" width="718"><strong>Analysis:</strong> Instant oatmeal and cereals are the highest in sugar co[ntent. Stay away from them if possible.  If you need to boost your iron levels, beef and pork are good options. If you don't eat meat, certain spices and wheat bran/flakes contain high levels of iron. Seaweed is also a good, iron rich snack. Ultimately, there are lots of ways to get iron in your diet besides meat.]{style="color:var(--color-neutral-600);"}</p>
<p><a href="https://github.com/erickbytes/Dataset-Analysis-Notebooks/blob/master/USDA%20Nutritional%20Data%20(2015)/USDA%20Food%20Nutrition.ipynb">See Full Jupyter Notebook</a></p>
<h2>3. <a href="https://data.world/quanticdata/occupation-and-salary-by-state-and-likelihood-of-automation/workspace/query?queryid=51754b08-7414-4f76-8a31-8b5c75166146">Job Computerisation Forecast Data</a></h2>
<p>This data orignates from a 2013 University of Oxford study and the United States Bureau of Labor Statistics. It provides two key values: probability (%) that a job will be computerised within 1-2 decades, and the number of jobs that currently exist for that profession in each state.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">plotting occupational automation risk - Python Marketer</span>
<span class="sd">https://atomic-temporary-107329037.wpcomstaging.com/2019/04/12/datasets-plotting-using-jupyter-pandas-and-matplotlib/</span>

<span class="sd">Find most common Illinois jobs affected and at highest risk of automation.</span>
<span class="sd">Source Data: https://data.world/quanticdata/occupation-and-salary-by-state-and-likelihood-of-automation/workspace/query?queryid=51754b08-7414-4f76-8a31-8b5c75166146</span>

<span class="sd">plt.text matplotlib docs: https://matplotlib.org/3.2.1/api/_as_gen/matplotlib.pyplot.text.html </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;high-risk-in-your-st-occupation-and-salary-by-state-and-likelihood-of-automation-QueryResult.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;Illinois&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">]</span> <span class="c1"># gets  &quot;highest risk&quot; subset</span>

<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;occupation&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Illinois&#39;</span><span class="p">,</span> 
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;DarkBlue&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># add corresponding percent over each bar</span>
<span class="n">probs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;probability&#39;</span><span class="p">])</span> 
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">probs</span><span class="p">):</span>
    <span class="n">percent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;0.&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">v</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> 
             <span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mf">.25</span><span class="p">,</span> 
             <span class="n">s</span><span class="o">=</span><span class="n">percent</span><span class="p">,</span> 
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> 
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> 
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>

<span class="n">white_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> 
                             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Est. % Probability of Computerisation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">white_patch</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Est. Number of Jobs At Risk in Illinois&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Occupation&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Most Common Illinois Jobs at &quot;Highest Risk&quot; of Being Computerised Within 15 Years&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Source: Carl Benedikt Frey and Michael A. Osborne (2013 University of Oxford Study)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;Source: data.world/quanticdata &amp; Bureau of Labor Statistics&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">textcoords</span><span class="o">=</span><span class="s1">&#39;offset points&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Most Common Jobs at &quot;High Risk&quot; of Being Computerised.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</code></pre></div>

<p><img alt="job_computerisation" class="alignnone size-full wp-image-1734" height="672" src="https://pythonmarketer.files.wordpress.com/2019/04/job_computerisation.png" width="1614"></p>
<p><strong>Analysis:</strong> It's strange to think that these common jobs, which currently make up a large portion of our economy, will likely be computerised some day. They all seem to be entry-level manual tasks. The promise of automation is that it frees humans up to focus on more meaningful or complex problems. How will the 125,000 cashiers in Illinois adapt when that is no longer a way to earn money?</p>
<p><a href="https://github.com/erickbytes/Dataset-Analysis-Notebooks/blob/master/Illinois%20Job%20Computerisation%20Forecast/Job%20Automation%20Forecast%20-%20Illinois.ipynb">See Full Jupyter Notebook</a></p>
<p><strong>The Plot Thickens...</strong></p>
<p>I've barely scratched the surface in my experience with datasets, but already found some very interesting data to inspect and play with. These data visualization skills are adaptable to many situations. All you need is good data to bring to life. Stay curious, my friends.</p>
<p><code>&lt;!-- wp:paragraph --&gt;</code></p>
<p><strong>Additional reading</strong></p>
<p><code>&lt;!-- /wp:paragraph --&gt;</code></p>
<p><code>&lt;!-- wp:paragraph --&gt;</code></p>
<p><a href="https://uppsala.instructure.com/courses/28112/files?preview=1042670">Matplotlib: Beyond the Default</a></p>
<p><code>&lt;!-- /wp:paragraph --&gt;</code></p>
                <div class="clear"></div>

                <div class="info">
                    <a href="../datasets-plotting-using-jupyter-pandas-and-matplotlib.html">posted at 05:59</a>
                    &nbsp;&middot;&nbsp;<a href="../category/automation-chicago-coding-data-pandas-plots-programming.html" rel="tag">automation, Chicago, coding, data, pandas, plots, programming</a>
                    &nbsp;&middot;
                    &nbsp;<a href="../tag/data-analysis.html" class="tags selected">data analysis</a>
                    &nbsp;<a href="../tag/datasets.html" class="tags">datasets</a>
                    &nbsp;<a href="../tag/jupyter.html" class="tags">jupyter</a>
                    &nbsp;<a href="../tag/matplotlib.html" class="tags">matplotlib</a>
                    &nbsp;<a href="../tag/python.html" class="tags">python</a>
                </div>
            </article>            <h4 class="date">May 12, 2018</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../pandas-pythons-excel-powerhouse.html" rel="bookmark" title="Permanent Link to &quot;A Stroll Through Pandas 1.0, Python’s Tabular Data Powerhouse&quot;">A Stroll Through Pandas 1.0, Python’s Tabular Data Powerhouse</a>
                </h2>

                
                

                <p><strong>Introduction</strong></p>
<p><a href="https://pandas.pydata.org/"><img alt="pandas" class="wp-image-2594 alignright" height="122" src="https://pythonmarketer.files.wordpress.com/2018/05/pandas.png" width="301"></a>Thanks to pandas, I have automated some data cleaning a[nd file reading processes at my job. ]{style="color:var(--color-text);"}[Here are some terms and code that have been useful or interesting to me after 2 years of exploration. I also checked out "]{style="color:var(--color-text);"}<a href="https://github.com/wesm/pydata-book">Python for Data Analysis</a>[" from the ]{style="color:var(--color-text);"}<a href="https://www.chipublib.org/">Chicago Public Library</a>[.]{style="color:var(--color-text);"}</p>
<p>If I could suggest anything to be successful with pandas, it is repetition. I use it nearly every day at work. Dive into its <a href="https://pandas.pydata.org/pandas-docs/stable/reference/index.html">API documentation.</a> There are tons of useful tools there, laid out with meticulous detail and examples. I began learning pandas with this PyCon 2015 <a href="https://www.youtube.com/watch?v=5JnMutdy6Fw">tutorial from Brandon Rhodes</a>, it's informative and entertaining! (It's a little dated now but I still recommend it.) The <em><a href="https://www.youtube.com/watch?v=_ZEWDGpM-vM">Reproducible Data Analysis in Jupyter video series</a></em> by Jake VanderPlas is also a great example of pandas-related workflows.</p>
<p><strong>Table of Contents</strong></p>
<ol>
<li>Python\pandas Installation and Version Compatibility</li>
<li>ACHIEVEMENT UNLOCKED: Welcome to pandas 1.0</li>
<li>Data Wrangling, Exploration and Broadcasting<ul>
<li><code>Series.str</code> &amp; <code>Series.dt</code> accessors</li>
<li><code>apply</code>, <code>applymap</code>, <code>lambda</code> and <code>map</code></li>
<li>featuring <code>pandas.to_markdown()</code></li>
<li>SQL operations with <code>df.merge()</code> and <code>pandas.read_sql()</code></li>
<li><code>pandas.read_clipboard()</code></li>
<li>converting between Series and DataFrame</li>
</ul>
</li>
<li>Turning json API responses into a dataframe with <code>pandas.json_normalize()</code></li>
<li>Plotting Visualizations with matplotlib</li>
<li>Supplementary Resources and Links</li>
</ol>
<h3>(1) [Python\pandas Installation and Version Compatibility]{style="color:var(--color-text);"}</h3>
<p>Python 3.6 and higher can <a href="https://pandas.pydata.org/pandas-docs/stable/getting_started/install.html">install pandas 1.0</a>.</p>
<p><strong>Installing Python 3.8 on Windows<br>
</strong></p>
<p>For Windows installation, see the python docs for an installer, "<a href="https://docs.python.org/3/using/windows.html">Using Python on Windows"</a>.</p>
<p><strong>Installing Python 3.8 on Ubuntu</strong></p>
<p><a href="https://linuxize.com/post/how-to-install-python-3-8-on-ubuntu-18-04/">Follow these steps to download and install Python 3.8 in the Ubuntu terminal.</a> To upgrade to pandas 1.0, I installed Python 3.8, the <a href="https://www.google.com/search?client=ubuntu&amp;channel=fs&amp;q=python+latest+stable+release&amp;ie=utf-8&amp;oe=utf-8">latest stable release</a>, "<a href="https://linuxize.com/post/how-to-install-python-3-8-on-ubuntu-18-04/">from source</a>" on Ubuntu 16.04.</p>
<p><strong>If you intend to use <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_markdown.html">pandas.to_markdown()</a> on Ubuntu, it might save you trouble to pre-emptively install the '_bz2' library before you build your Python from source.<br>
</strong></p>
<p>On Ubuntu, I ran into ModuleNotFoundError: No module named '_bz2' and fixed by entering in the terminal: <code>sudo apt-get install libbz2-dev</code></p>
<p>I also saw this message when completing install:</p>
<blockquote>
<p>The necessary bits to build these optional modules were not found. To find the necessary bits, look in setup.py in detect-modules() for the module's name.</p>
</blockquote>
<p><strong>If you need to re-build Python on Ubuntu, enter:</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">erick</span><span class="o">/</span><span class="n">Python</span><span class="o">-</span><span class="mf">3.8</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span>
<span class="o">./</span><span class="n">configure</span><span class="w"> </span><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">loadable</span><span class="o">-</span><span class="n">sqlite</span><span class="o">-</span><span class="n">extensions</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">install</span>
</code></pre></div>

<p>I installed missing  _bz2 and _sqllite3 modules then re-built with these commands.</p>
<p><strong>Installing Older pandas Versions on Ubuntu</strong></p>
<p>The version downloaded with this command is about 6 months behind the current version. For me, this installed pandas 0.17 on Ubuntu:</p>
<p><code class="docutils literal notranslate">sudo apt-get install python3-pandas</code></p>
<p>As of February 2020, this command <a href="https://docs.python.org/3/installing/index.html">installs pandas version 0.24 with pip</a> when used with Python 3.5 on Linux Ubuntu 16.04:</p>
<p><code>python3.5 -m pip install pandas</code></p>
<p><img alt="successful_python_install" class="alignnone wp-image-2420" height="186" src="https://pythonmarketer.files.wordpress.com/2018/05/successful_python_install.jpg" style="color:var(--color-text);" width="676"></p>
<p><strong>If pandas is already installed, you can upgrade with <a href="https://pythonmarketer.wordpress.com/2018/01/20/how-to-python-pip-install-new-libraries/">pip</a>:</strong></p>
<p>[caption id="attachment_2572" align="alignright" width="179"]<img alt="pip_list" class="alignnone wp-image-2572" height="230" src="http://pythonmarketer.files.wordpress.com/2018/05/d1733-pip_list-e1581434945203.jpg" width="179"> Enter pip list to see installed libraries.[/caption]</p>
<p><code>python -m pip install --upgrade pandas</code></p>
<p>To check if pip is installed: <code>python -m pip list</code></p>
<p><strong>Consider following best practice and create a <a href="https://pythonmarketer.wordpress.com/2018/04/10/creating-isolated-python-environments-with-virtualenv/">virtual environment</a> with your new Python version. <a href="https://docs.python.org/3/library/venv.html">venv</a> wasn't included in my Python 3.8 installation on Ubuntu 16.04, so I installed virtualenv:</strong></p>
<p><code>python -m pip --user install virtualenv</code></p>
<p><strong>Let's create a new virtual environment. Enter in terminal or command prompt:</strong></p>
<p><code>virtualenv -p python3.8 add_env_name_here</code></p>
<p><strong>Now, activate your new virtual environment on Linux:</strong></p>
<p><code>cd add_env_name_here/bin &amp;&amp; source activate</code></p>
<p><strong>Or activate environment on Windows:</strong></p>
<p><code>cd add_env_name_here\scripts &amp; activate</code></p>
<p><strong>"ImportError: Missing optional dependency 'tabulate'. Use pip or conda to install tabulate:" To use pd.to_markdown(), install Tabulate:</strong></p>
<p><code>python -m pip install tabulate</code></p>
<p><strong>To use pd.read_clipboard() on Linux, install <a href="https://github.com/astrand/xclip">xclip</a> or <a href="https://askubuntu.com/questions/705620/xclip-vs-xsel">xsel:</a></strong>[ ]{.st}</p>
<p>[<code>sudo apt-get install xclip</code><strong><br>
</strong>]{.st}</p>
<p><strong>I also saw a prompt to install pyperclip:</strong></p>
<p><code>python -m pip install pyperclip</code></p>
<p><strong>Now install pandas 1.0 and <a href="https://matplotlib.org/users/installing.html">matplotlib</a> in your virtual environment.</strong></p>
<div class="highlight"><pre><span></span><code>python3.8 -m pip install pandas
python -m pip install -U matplotlib
</code></pre></div>

<h3>(2) Welcome to pandas 1.0</h3>
<p>You did it! Welcome to the good life. The basis of pandas is the "<a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">dataframe</a>", commonly abbreviated as df, which is similar to a spreadsheet. Another core pandas object is the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html">pandas.Series</a> object, which is similar to a Python list or <a href="http://cs231n.github.io/python-numpy-tutorial/">numpy</a> array. When imported, pandas is aliased as "pd". The pd object allows you to access many useful pandas functions. I'll use it interchangeably with pandas in this post.</p>
<blockquote>
<p>The library’s name derives from <strong>pan</strong>el <strong>da</strong>ta, a common term for multidimensional data sets encountered in statistics and econometrics.</p>
<p><a href="https://www.dlr.de/sc/Portaldata/15/Resources/dokumente/pyhpc2011/submissions/pyhpc2011_submission_9.pdf">pandas: a Foundational Python Library for Data Analysis and Statistics</a></p>
<p>- Wes McKinney</p>
</blockquote>
<h3>(3) <a href="https://en.wikipedia.org/wiki/Data_wrangling">Data Wrangling</a>, Exploration and Broadcasting</h3>
<p>**Data is commonly read in from file with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">pd.read_csv()</a>. **</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;my_bank_statement.csv&#39;</span>
<span class="c1"># you may sometimes need to specify an alternate encoding: encoding = &quot;ISO-8859-1&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># returns a tuple: (# of rows, # of columns)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</code></pre></div>

<p><strong>Create a dataframe from a list of Python lists, named movies below, with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pd.DataFrame</a>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Release Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Character&quot;</span><span class="p">,</span> <span class="s2">&quot;Actor&quot;</span><span class="p">,</span> <span class="s2">&quot;Movie Budget&quot;</span><span class="p">,</span> <span class="s2">&quot;Worldwide Gross&quot;</span><span class="p">]</span>
<span class="n">movies</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Ocean&#39;s 11&quot;</span><span class="p">,</span> <span class="s2">&quot;12/7/2001&quot;</span><span class="p">,</span> <span class="s2">&quot;Danny Ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;George Clooney&quot;</span><span class="p">,</span><span class="s2">&quot;$85,000,000&quot;</span><span class="p">,</span><span class="s2">&quot; $450,728,529&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ocean&#39;s 11&quot;</span><span class="p">,</span> <span class="s2">&quot;12/7/2001&quot;</span><span class="p">,</span> <span class="s2">&quot;Tess Ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;Julia Roberts&quot;</span><span class="p">,</span><span class="s2">&quot;$85,000,000&quot;</span><span class="p">,</span><span class="s2">&quot; $450,728,529&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Runaway Bride&quot;</span><span class="p">,</span> <span class="s2">&quot;6/30/1999&quot;</span><span class="p">,</span> <span class="s2">&quot;Ike Graham&quot;</span><span class="p">,</span> <span class="s2">&quot;Richard Gere&quot;</span><span class="p">,</span><span class="s2">&quot;$70,000,000&quot;</span><span class="p">,</span><span class="s2">&quot;$309,457,509&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Runaway Bride&quot;</span><span class="p">,</span> <span class="s2">&quot;6/30/1999&quot;</span><span class="p">,</span> <span class="s2">&quot;Maggy Carpenter&quot;</span><span class="p">,</span> <span class="s2">&quot;Julia Roberts&quot;</span><span class="p">,</span><span class="s2">&quot;$70,000,000&quot;</span><span class="p">,</span><span class="s2">&quot;$309,457,509&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Bonnie and Clyde&quot;</span><span class="p">,</span> <span class="s2">&quot;9/1/1967&quot;</span><span class="p">,</span> <span class="s2">&quot;Clyde Barrow&quot;</span><span class="p">,</span> <span class="s2">&quot;Warren Beaty&quot;</span><span class="p">,</span><span class="s2">&quot;$2,500,000&quot;</span><span class="p">,</span> <span class="s2">&quot;$70,000,000&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Bonnie and Clyde&quot;</span><span class="p">,</span> <span class="s2">&quot;9/1/1967&quot;</span><span class="p">,</span> <span class="s2">&quot;Bonnie Parker&quot;</span><span class="p">,</span> <span class="s2">&quot;Faye Dunaway&quot;</span><span class="p">,</span><span class="s2">&quot;$2,500,000&quot;</span><span class="p">,</span> <span class="s2">&quot;$70,000,000&quot;</span><span class="p">]]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">movies</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span><span class="s2">&quot;Character&quot;</span><span class="p">,</span> <span class="s2">&quot;Actor&quot;</span><span class="p">,</span> <span class="s2">&quot;Movie Budget&quot;</span><span class="p">,</span> <span class="s2">&quot;Worldwide Gross&quot;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">))</span>
</code></pre></div>

<p><strong>Let's print the table to our terminal with <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_markdown.html">pd.to_markdown()</a>, which is[ <a href="https://pandas.pydata.org/pandas-docs/version/1.0.0/whatsnew/v1.0.0.html">new in pandas version 1.0.0</a>:]{.versionmodified .added}</strong></p>
<p><img alt="simple_layout_markdown" class="alignnone size-full wp-image-2538" height="189" src="https://pythonmarketer.files.wordpress.com/2018/05/simple_layout_markdown.jpg" width="847"></p>
<p><strong>Slicing and sorting a dataframe, removing duplicates, and working with datetime objects</strong></p>
<ol>
<li>Let's create a new dataframe slice with only two columns</li>
<li>Drop duplicate movies</li>
<li>Convert the dates to datetime objects</li>
<li>Get the year from an array of datetime objects</li>
<li>Set the year as the dataframe index</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="o">&lt;!--</span><span class="w"> </span><span class="o">--&gt;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pd</span><span class="p">.</span><span class="nx">DataFrame</span><span class="p">(</span><span class="nx">movies</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="p">=</span><span class="nx">column_names</span><span class="p">)</span>
<span class="nx">date_df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">df</span><span class="p">[[</span><span class="err">&#39;</span><span class="nx">Title</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Date</span><span class="err">&#39;</span><span class="p">]].</span><span class="nx">drop_duplicates</span><span class="p">(</span><span class="nx">subset</span><span class="p">=[</span><span class="err">&#39;</span><span class="nx">Title</span><span class="err">&#39;</span><span class="p">])</span>
<span class="nx">date_df</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Date</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pd</span><span class="p">.</span><span class="nx">to_datetime</span><span class="p">(</span><span class="nx">date_df</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Date</span><span class="err">&#39;</span><span class="p">])</span>
<span class="err">#</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">year</span><span class="w"> </span><span class="nx">column</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">pd</span><span class="p">.</span><span class="nx">Series</span><span class="p">.</span><span class="nx">dt</span><span class="w"> </span><span class="nx">datetime</span><span class="w"> </span><span class="nx">accessor</span><span class="p">:</span>
<span class="nx">date_df</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Year</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">df</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Date</span><span class="err">&#39;</span><span class="p">].</span><span class="nx">dt</span><span class="p">.</span><span class="nx">year</span>
<span class="nx">date_df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">date_df</span><span class="p">.</span><span class="nx">sort_values</span><span class="p">(</span><span class="nx">by</span><span class="p">=[</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Date</span><span class="err">&#39;</span><span class="p">])</span>
<span class="nx">date_df</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">date_df</span><span class="p">.</span><span class="nx">set_index</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">Release</span><span class="w"> </span><span class="nx">Year</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">date_df</span><span class="p">.</span><span class="nx">to_markdown</span><span class="p">(</span><span class="nx">showindex</span><span class="p">=</span><span class="nx">False</span><span class="p">,</span><span class="w"> </span><span class="nx">tablefmt</span><span class="p">=</span><span class="err">&#39;</span><span class="nx">simple</span><span class="err">&#39;</span><span class="p">))</span>
</code></pre></div>

<h2><img alt="dates_of_movies" class="alignnone wp-image-2537" height="148" src="https://pythonmarketer.files.wordpress.com/2018/05/dates_of_movies.jpg" width="662"></h2>
<p><strong>Applying Broadcasting in pandas</strong></p>
<p>Broadcasting means to map a function or an arithmetic calculation over an over an array (using apply or map) or dataframe (applymap).</p>
<blockquote>
<p>"Summing up, apply works on a row/column basis of a DataFrame, applymap works element-wise on a DataFrame, and map works element-wise on a Series."</p>
<p>- Stack Overflow [<a href="https://stackoverflow.com/questions/19798153/difference-between-map-applymap-and-apply-methods-in-pandas">Source</a>]</p>
</blockquote>
<p><strong>Applying a function to a pandas column<br>
</strong></p>
<ul>
<li>Convert columns to int and calculate the difference between two columns.</li>
<li>Let's format those integers back to dollars with python's lambda and pandas' applymap for extra jazz.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&lt;!--</span><span class="w"> </span><span class="o">--&gt;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">format_dollars_as_int</span><span class="p">(</span><span class="n">dollars</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="ss">&quot;&quot;&quot;Accepts a dollar formatted string, returns an int.&quot;&quot;&quot;</span>
<span class="w">    </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dollars</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

<span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">movies</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=[</span><span class="n">&#39;Title&#39;</span><span class="o">]</span><span class="p">)</span>
<span class="n">df</span><span class="o">[</span><span class="n">[&#39;Movie Budget&#39;,&#39;Worldwide Gross&#39;</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">[&#39;Movie Budget&#39;,&#39;Worldwide Gross&#39;</span><span class="o">]</span><span class="err">]</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nf">str</span><span class="p">).</span><span class="n">applymap</span><span class="p">(</span><span class="n">format_dollars_as_int</span><span class="p">)</span>
<span class="n">df</span><span class="o">[</span><span class="n">&#39;Movie Net Income&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">&#39;Worldwide Gross&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">&#39;Movie Budget&#39;</span><span class="o">]</span>
<span class="n">money_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&#39;Movie Budget&#39;, &#39;Worldwide Gross&#39;,&#39;Movie Net Income&#39;</span><span class="o">]</span>
<span class="n">df</span><span class="o">[</span><span class="n">money_columns</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">money_columns</span><span class="o">]</span><span class="p">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="s1">&#39;${:,}&#39;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</code></pre></div>

<p><strong>Creating a new column and writing to a .csv file</strong></p>
<ul>
<li>Then add the IMDB ratings of our three films in a new column.</li>
<li>Finally, write the result to markdown and a csv file.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">&lt;!--</span><span class="w"> </span><span class="o">--&gt;</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">column</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">three</span><span class="w"> </span><span class="nx">movies</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">IMDB</span><span class="w"> </span><span class="nx">ratings</span><span class="w"> </span>
<span class="nx">df</span><span class="p">[</span><span class="err">&#39;</span><span class="nx">IMDB</span><span class="w"> </span><span class="nx">Rating</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">list</span><span class="p">([</span><span class="m m-Double">7.8</span><span class="p">,</span><span class="m m-Double">5.5</span><span class="p">,</span><span class="m m-Double">7.8</span><span class="p">])</span><span class="w"> </span>
<span class="nx">print</span><span class="p">(</span><span class="nx">df</span><span class="p">.</span><span class="nx">to_markdown</span><span class="p">(</span><span class="nx">showindex</span><span class="p">=</span><span class="nx">False</span><span class="p">,</span><span class="w"> </span><span class="nx">tablefmt</span><span class="p">=</span><span class="err">&#39;</span><span class="nx">simple</span><span class="err">&#39;</span><span class="p">))</span>
<span class="nx">df</span><span class="p">.</span><span class="nx">to_csv</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">Movies</span><span class="p">.</span><span class="nx">csv</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">index</span><span class="p">=</span><span class="nx">False</span><span class="p">)</span>
</code></pre></div>

<p><img alt="IMDB_movies" class="alignnone size-full wp-image-2540" height="117" src="https://pythonmarketer.files.wordpress.com/2018/05/imdb_movies.jpeg" width="870"></p>
<p><code>print(df.Actor.value_counts().to_markdown(tablefmt="github"))</code></p>
<p>[caption id="attachment_2539" align="alignright" width="189"]<img alt="actor" class="alignnone wp-image-2539" height="111" src="https://pythonmarketer.files.wordpress.com/2018/05/actor.jpg" width="189"> Count the Actors with df.Actor.value_counts()[/caption]</p>
<hr>
<blockquote>
<p><strong>I also must mention <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.value_counts.html">pandas.Series.value_counts()</a>, because it's so darn handy :D</strong></p>
</blockquote>
<hr>
<p><strong>Notice for column names without spaces, you can use dot notation instead of brackets:</strong></p>
<p><code>df.Actor</code> <em>vs.</em> <code>df['Actor']</code></p>
<p><strong>Lowercase column names Python's map function:</strong></p>
<p>`df.columns = map(str.lower, df.columns)```</p>
<p><strong>Strip whitespace from a column of strings with the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.html">pandas.Series.str</a> accessor:</strong><br>
<code>df['Character'] = df['Character'].astype(str).str.strip()</code></p>
<p><strong>Fix pesky leading zero zip codes with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.zfill.htmlhttps://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.zfill.html">str.zfill()</a>:</strong></p>
<p><code>log_df['zip'] = log_df['zip'].astype(str).str.zfill(5)</code></p>
<p><strong>Get a row by index number us <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html">pandas.DataFrame.loc[]</a>:</strong></p>
<div class="highlight"><pre><span></span><code>first_row = df.loc[0, df.columns]
third_row = df.loc[2, df.columns]
</code></pre></div>

<p><strong>Filter the df to get rows where the actor is 'Julia Roberts'.</strong></p>
<div class="highlight"><pre><span></span><code>julia_roberts_movies = df[df.Actor==&#39;Julia Roberts&#39;].reset_index(drop=True) 
print(julia_roberts_movies.head())
</code></pre></div>

<p><strong>"Get" an item from a column of lists with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.get.html">str.get()</a>.</strong></p>
<div class="highlight"><pre><span></span><code># returns first item in each cell&#39;s list into new column
df[&#39;first_item&#39;] = df[&#39;items&#39;].str.get(0)
</code></pre></div>

<p><strong>Execute SQL-like operations between dataframes with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">df.merge()</a>.</strong></p>
<p>First, use <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.copy.html">df.copy()</a> to create a new dataframe copy of our actors table above.  By default, df.merge() uses an inner join to merge two dfs on a common column. Let's add each film's release year from our date_df to our original actors table, with an inner join based on 'Title':</p>
<div class="highlight"><pre><span></span><code>actors = df.copy(deep=True)
# slice only the columns we want to merge:
date_df = date_df[[&#39;Title&#39;,&#39;Release Year&#39;]] 
joined_df = actors.merge(date_df, on=&#39;Title&#39;, how=&#39;inner&#39;)
# You can pass the number of rows to see to head. It defaults to 5.
print(joined_df.head(10))
</code></pre></div>

<p><strong>Execute database queries with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_sql.html">pd.read_sql()</a>.</strong></p>
<p>When the chunksize argument is passed, pd.read_sql() returns an iterator. We can use this to iterate through a database with lots of rows. When combined with DB connection libraries like <a href="https://pythonmarketer.wordpress.com/2019/11/30/inserting-new-records-into-a-microsoft-access-database-with-python/">pyodbc</a> or SQLAlchemy, you can process a database in chunks. In this example, it's an Access DB connection via pyodbc to process 500,000 rows per chunk. Pyodbc works on a wide range of other databases also.</p>
<blockquote>
<p>uses <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.isin.html">pd.Series.isin()</a> to check if each email is in the DB.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pyodbc</span>

<span class="n">emails</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;email@email.com&#39;</span><span class="p">,</span> <span class="s1">&#39;notanemail@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;gmail@gmail.com&#39;</span><span class="p">]</span>
<span class="n">connection_string</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Driver={Microsoft Access Driver (*.mdb, *.accdb)};DBQ=C:\path_to_db\Email_DB.accb;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connection_string</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT *</span>
<span class="s2">    FROM   ADD_TABLE_NAME</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">db_chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">500000</span><span class="p">)):</span>
    <span class="n">emails_in_db</span> <span class="o">=</span> <span class="n">db_chunk</span><span class="p">[</span><span class="n">db_chunk</span><span class="p">[</span><span class="s1">&#39;EmailAddress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">emails</span><span class="p">)]</span>
    <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">emails_in_db</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">emails_in_db</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
<span class="n">emails_in_db</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;DB_Email_Query_Results.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>In case you are wondering, enumerate is a <a href="https://docs.python.org/3/library/functions.html">python built-in</a> for enumerating, or counting an iterable, e.g. list or generator, as you iterate through it.</p>
</blockquote>
<p><strong>Using <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_clipboard.html">pd.read_clipboard():</a><br>
</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">clipboard_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_clipboard</span><span class="p">()</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">clipboard_contents</span><span class="p">)</span>
</code></pre></div>

<p><strong>Use <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_clipboard.html">pd.to_clipboard()</a> to store a dataframe as clipboard text:<br>
</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">truths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pandas is great&#39;</span><span class="p">,</span><span class="s1">&#39;I love pandas&#39;</span><span class="p">,</span><span class="s1">&#39;pandas changed my life&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">truths</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Truths&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_clipboard</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<span class="n">clipboard_contents</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Press ctrl-v &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">clipboard_contents</span><span class="p">)</span>
</code></pre></div>

<p><strong>Convert the clipboard contents to df with <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">pd.DataFrame()</a>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="n">clipboard_contents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Press ctrl-v &#39;</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">clipboard_contents</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<p><strong>If the clipboard dataframe has one column, you could <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.squeeze.html#pandas.DataFrame.squeeze">squeeze</a> the clipboard contents into a <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html">pd.Series</a> object:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="n">clipboard_text</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_clipboard</span><span class="p">()</span> 
<span class="n">clipboard_contents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">clipboard_text</span><span class="p">)</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">clipboard_contents</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Clipboard Data&#39;</span><span class="p">])</span>
<span class="n">clipboard_series</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">clipboard_series</span><span class="p">))</span>
</code></pre></div>

<p><strong>Inversely, consider using <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_frame.html#pandas.Series.to_frame">pandas.Series.to_frame()</a> to convert a Series to a dataframe:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="n">clipboard_contents</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Press ctrl-v &#39;</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">clipboard_contents</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

<h3>(4) Turning json API responses into a dataframe with pd.json_normalize()</h3>
<p><strong>For <a href="https://pandas.pydata.org/pandas-docs/version/0.17.0/generated/pandas.io.json.json_normalize.html">older pandas versions</a>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pandas.io.json</span> <span class="kn">import</span> <span class="n">json_normalize</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;pseudo_API.com/endpoint/&#39;</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;page_size&#39;</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">api_type</span><span class="o">=</span><span class="s1">&#39;contact_sync&#39;</span> <span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1"># decode response into json</span>
<span class="c1"># turn subset of json into df</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;any_key&#39;</span><span class="p">])</span>
</code></pre></div>

<p><strong>Update: beginning in pandas 1.0, <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.json_normalize.html">json_normalize</a> became a top-level pandas namespace.</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span> 
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;pseudo_API.com/endpoint/&#39;</span> 
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;page_size&#39;</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">api_type</span><span class="o">=</span><span class="s1">&#39;contact_sync&#39;</span> <span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1"># decode response into json </span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;any_key&#39;</span><span class="p">])</span>
</code></pre></div>

<blockquote>
<p>pandas.json_normalize() is now exposed in the top-level namespace. Usage of json_normalize as pandas.io.json.json_normalize is now deprecated and it is recommended to use json_normalize as pandas.json_normalize() instead (GH27586).</p>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/whatsnew/v1.0.0.html">What's new in pandas 1.0.0</a></p>
</blockquote>
<h3>(5) Plotting Visualizations with matplotlib</h3>
<p><strong>Make a bar plot of the movie release year counts using pandas and matplotlib formatting.</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>

<span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Release Date&quot;</span><span class="p">,</span> <span class="s2">&quot;Character&quot;</span><span class="p">,</span> <span class="s2">&quot;Actor&quot;</span><span class="p">]</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Ocean&#39;s 11&quot;</span><span class="p">,</span> <span class="s2">&quot;12/7/2001&quot;</span><span class="p">,</span> <span class="s2">&quot;Danny Ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;George Clooney&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Ocean&#39;s 11&quot;</span><span class="p">,</span> <span class="s2">&quot;12/7/2001&quot;</span><span class="p">,</span> <span class="s2">&quot;Tess Ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;Julia Roberts&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Runaway Bride&quot;</span><span class="p">,</span> <span class="s2">&quot;6/30/1999&quot;</span><span class="p">,</span> <span class="s2">&quot;Ike Graham&quot;</span><span class="p">,</span> <span class="s2">&quot;Richard Gere&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Runaway Bride&quot;</span><span class="p">,</span> <span class="s2">&quot;6/30/1999&quot;</span><span class="p">,</span> <span class="s2">&quot;Maggy Carpenter&quot;</span><span class="p">,</span> <span class="s2">&quot;Julia Roberts&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Bonnie and Clyde&quot;</span><span class="p">,</span> <span class="s2">&quot;9/1/1967&quot;</span><span class="p">,</span> <span class="s2">&quot;Clyde Barrow&quot;</span><span class="p">,</span> <span class="s2">&quot;Richard Gere&quot;</span><span class="p">],</span>
<span class="p">[</span><span class="s2">&quot;Bonnie and Clyde&quot;</span><span class="p">,</span> <span class="s2">&quot;9/1/1967&quot;</span><span class="p">,</span> <span class="s2">&quot;Bonnie Parker&quot;</span><span class="p">,</span> <span class="s2">&quot;Julia Roberts&quot;</span><span class="p">]]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Release Year of Movies&#39;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span> 
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;images/Movie_Plot.png&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Use Jupyter Notebook to show plot, and/or download plot from command line. Read more about <a href="https://pythonmarketer.wordpress.com/2019/04/12/datasets-plotting-using-jupyter-pandas-and-matplotlib/">plotting with Jupyter/pandas/Python here</a>.</p>
<p>**Plot George Clooney's movies over time in a line graph. [<a href="https://www.youtube.com/watch?v=5JnMutdy6Fw">Source</a>] **</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Actor</span><span class="o">==</span><span class="s1">&#39;George Clooney&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;/path/to/figure.pdf&#39;</span><span class="p">)</span>
</code></pre></div>

<h3>(7) Supplementary Resources and Guides</h3>
<p><strong>Popular Supporting Libraries and Tools</strong></p>
<ul>
<li><a href="https://www.numpy.org/">NumPy (Arrays and math)</a></li>
<li><a href="https://matplotlib.org/#">Matplotlib (Visualization)</a></li>
<li><a href="https://seaborn.pydata.org/">Seaborn (Visualization)</a></li>
<li><a href="https://bokeh.pydata.org/en/latest/docs/installation.html">Bokeh (Visualization)</a></li>
<li><a href="https://jupyter.org/">Jupyter Notebook (Reproducible Sharing and Viz)</a></li>
</ul>
<p><strong>Supplementary Resources:</strong></p>
<ul>
<li><a href="https://www.youtube.com/watch?v=5JnMutdy6Fw">pandas from the Ground Up (Video)</a></li>
<li><a href="https://colab.research.google.com/drive/1a4sbKG7jOJGn4oeonQPA8XjJm7OYgcdX">Google's Intro to pandas Jupyter Notebook</a> (Tutorial)</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/10min.html">10 Minutes to pandas (Documentation)</a></li>
<li><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.r_.html">Numpy's</a> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.r_.html">r and c_ stacking helpers to concatenate arrays</a></li>
<li><a href="http://rhodesmill.org/brandon/2014/pandas-payroll/">Calculating Taxes with pandas</a> (Blog)</li>
</ul>
                <div class="clear"></div>

                <div class="info">
                    <a href="../pandas-pythons-excel-powerhouse.html">posted at 03:39</a>
                    &nbsp;&middot;&nbsp;<a href="../category/coding-data-excel-pandas-python.html" rel="tag">coding, data, excel, pandas, python</a>
                    &nbsp;&middot;
                    &nbsp;<a href="../tag/data-analysis.html" class="tags selected">data analysis</a>
                    &nbsp;<a href="../tag/programming.html" class="tags">programming</a>
                    &nbsp;<a href="../tag/software.html" class="tags">software</a>
                </div>
            </article>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/tcarwash/blue-penguin-dark">Blue Penguin Dark</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="../feeds/all.atom.xml" rel="alternate">Atom Feed</a>
                &middot;
                <a href="../feeds/all.rss.xml" rel="alternate">Rss Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>